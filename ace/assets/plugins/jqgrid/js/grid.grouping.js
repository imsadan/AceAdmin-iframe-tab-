(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./grid.base"],a)}else{a(jQuery)}}(function(a){a.jgrid.extend({groupingSetup:function(){return this.each(function(){var b=this,g,h,e,d=b.p.colModel,f=b.p.groupingView,c=a.jgrid.styleUI[(b.p.styleUI||"jQueryUI")].grouping;if(f!==null&&((typeof f==="object")||a.isFunction(f))){if(!f.plusicon){f.plusicon=c.icon_plus}if(!f.minusicon){f.minusicon=c.icon_minus}if(!f.groupField.length){b.p.grouping=false}else{if(f.visibiltyOnNextGrouping===undefined){f.visibiltyOnNextGrouping=[]}f.lastvalues=[];if(!f._locgr){f.groups=[]}f.counters=[];for(g=0;g<f.groupField.length;g++){if(!f.groupOrder[g]){f.groupOrder[g]="asc"}if(!f.groupText[g]){f.groupText[g]="{0}"}if(typeof f.groupColumnShow[g]!=="boolean"){f.groupColumnShow[g]=true}if(typeof f.groupSummary[g]!=="boolean"){f.groupSummary[g]=false}if(!f.groupSummaryPos[g]){f.groupSummaryPos[g]="footer"}if(f.groupColumnShow[g]===true){f.visibiltyOnNextGrouping[g]=true;a(b).jqGrid("showCol",f.groupField[g])}else{f.visibiltyOnNextGrouping[g]=a("#"+a.jgrid.jqID(b.p.id+"_"+f.groupField[g])).is(":visible");a(b).jqGrid("hideCol",f.groupField[g])}}f.summary=[];if(f.hideFirstGroupCol){if(a.isArray(f.formatDisplayField)&&!a.isFunction(f.formatDisplayField[0])){f.formatDisplayField[0]=function(i){return i}}}for(h=0,e=d.length;h<e;h++){if(f.hideFirstGroupCol){if(!d[h].hidden&&f.groupField[0]===d[h].name){d[h].formatter=function(){return""}}}if(d[h].summaryType){if(d[h].summaryDivider){f.summary.push({nm:d[h].name,st:d[h].summaryType,v:"",sd:d[h].summaryDivider,vd:"",sr:d[h].summaryRound,srt:d[h].summaryRoundType||"round"})}else{f.summary.push({nm:d[h].name,st:d[h].summaryType,v:"",sr:d[h].summaryRound,srt:d[h].summaryRoundType||"round"})}}}}}else{b.p.grouping=false}})},groupingPrepare:function(c,b){this.each(function(){var k=this.p.groupingView,d=this,l,m=function(){if(a.isFunction(this.st)){this.v=this.st.call(d,this.v,this.nm,c)}else{this.v=a(d).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,c);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=a(d).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,c)}}},j=k.groupField.length,h,n,f,g,e=0;for(l=0;l<j;l++){h=k.groupField[l];f=k.displayField[l];n=c[h];g=f==null?null:c[f];if(g==null){g=n}if(n!==undefined){if(b===0){k.groups.push({idx:l,dataIndex:h,value:n,displayValue:g,startRow:b,cnt:1,summary:[]});k.lastvalues[l]=n;k.counters[l]={cnt:1,pos:k.groups.length-1,summary:a.extend(true,[],k.summary)};a.each(k.counters[l].summary,m);k.groups[k.counters[l].pos].summary=k.counters[l].summary}else{if(typeof n!=="object"&&(a.isArray(k.isInTheSameGroup)&&a.isFunction(k.isInTheSameGroup[l])?!k.isInTheSameGroup[l].call(d,k.lastvalues[l],n,l,k):k.lastvalues[l]!==n)){k.groups.push({idx:l,dataIndex:h,value:n,displayValue:g,startRow:b,cnt:1,summary:[]});k.lastvalues[l]=n;e=1;k.counters[l]={cnt:1,pos:k.groups.length-1,summary:a.extend(true,[],k.summary)};a.each(k.counters[l].summary,m);k.groups[k.counters[l].pos].summary=k.counters[l].summary}else{if(e===1){k.groups.push({idx:l,dataIndex:h,value:n,displayValue:g,startRow:b,cnt:1,summary:[]});k.lastvalues[l]=n;k.counters[l]={cnt:1,pos:k.groups.length-1,summary:a.extend(true,[],k.summary)};a.each(k.counters[l].summary,m);k.groups[k.counters[l].pos].summary=k.counters[l].summary}else{k.counters[l].cnt+=1;k.groups[k.counters[l].pos].cnt=k.counters[l].cnt;a.each(k.counters[l].summary,m);k.groups[k.counters[l].pos].summary=k.counters[l].summary}}}}}});return this},groupingToggle:function(b){this.each(function(){var c=this,g=c.p.groupingView,p=b.split("_"),j=parseInt(p[p.length-2],10);p.splice(p.length-2,2);var u=p.join("_"),i=g.minusicon,k=g.plusicon,q=a("#"+a.jgrid.jqID(b)),l=q.length?q[0].nextSibling:null,t=a("#"+a.jgrid.jqID(b)+" span.tree-wrap-"+c.p.direction),f=function(r){var v=a.map(r.split(" "),function(w){if(w.substring(0,u.length+1)===u+"_"){return parseInt(w.substring(u.length+1),10)}});return v.length>0?v[0]:undefined},h,n,d=false,o=false,e=c.p.frozenColumns?c.p.id+"_frozen":false,s=e?a("#"+a.jgrid.jqID(b),"#"+a.jgrid.jqID(e)):false,m=(s&&s.length)?s[0].nextSibling:null;if(t.hasClass(i)){if(g.showSummaryOnHide){if(l){while(l){h=f(l.className);if(h!==undefined&&h<=j){break}a(l).hide();l=l.nextSibling;if(e){a(m).hide();m=m.nextSibling}}}}else{if(l){while(l){h=f(l.className);if(h!==undefined&&h<=j){break}a(l).hide();l=l.nextSibling;if(e){a(m).hide();m=m.nextSibling}}}}t.removeClass(i).addClass(k);d=true}else{if(l){n=undefined;while(l){h=f(l.className);if(n===undefined){n=h===undefined}o=a(l).hasClass("ui-subgrid")&&a(l).hasClass("ui-sg-collapsed");if(h!==undefined){if(h<=j){break}if(h===j+1){if(!o){a(l).show().find(">td>span.tree-wrap-"+c.p.direction).removeClass(i).addClass(k);if(e){a(m).show().find(">td>span.tree-wrap-"+c.p.direction).removeClass(i).addClass(k)}}}}else{if(n){if(!o){a(l).show();if(e){a(m).show()}}}}l=l.nextSibling;if(e){m=m.nextSibling}}}t.removeClass(k).addClass(i)}a(c).triggerHandler("jqGridGroupingClickGroup",[b,d]);if(a.isFunction(c.p.onClickGroup)){c.p.onClickGroup.call(c,b,d)}});return false},groupingRender:function(c,b,d,e){return this.each(function(){var f=this,l=f.p.groupingView,s="",o="",n,h,r=l.groupCollapse?l.plusicon:l.minusicon,m,j=[],p=l.groupField.length,i=a.jgrid.styleUI[(f.p.styleUI||"jQueryUI")].common;r=r+" tree-wrap-"+f.p.direction;a.each(f.p.colModel,function(v,x){var w;for(w=0;w<p;w++){if(l.groupField[w]===x.name){j[w]=v;break}}});var u=0;function k(y,z,v){var A=false,w;if(z===0){A=v[y]}else{var x=v[y].idx;if(x===0){A=v[y]}else{for(w=y;w>=0;w--){if(v[w].idx===x-z){A=v[w];break}}}}return A}function g(A,B,z,x){var w=k(A,B,z),v=f.p.colModel,G,y=w.cnt,D="",C;for(C=x;C<b;C++){var E="<td "+f.formatCol(C,1,"")+">&#160;</td>",F="{0}";a.each(w.summary,function(){if(this.nm===v[C].name){if(v[C].summaryTpl){F=v[C].summaryTpl}if(typeof this.st==="string"&&this.st.toLowerCase()==="avg"){if(this.sd&&this.vd){this.v=(this.v/this.vd)}else{if(this.v&&y>0){this.v=(this.v/y)}}}try{this.groupCount=w.cnt;this.groupIndex=w.dataIndex;this.groupValue=w.value;G=f.formatter("",this.v,C,this)}catch(H){G=this.v}E="<td "+f.formatCol(C,1,"")+">"+a.jgrid.template(F,G)+"</td>";return false}});D+=E}return D}var t=a.makeArray(l.groupSummary),q;t.reverse();q=f.p.multiselect?' colspan="2"':"";a.each(l.groups,function(A,F){if(l._locgr){if(!(F.startRow+F.cnt>(d-1)*e&&F.startRow<d*e)){return true}}u++;h=f.p.id+"ghead_"+F.idx;n=h+"_"+A;o="<span style='cursor:pointer;margin-right:8px;margin-left:5px;' class='"+i.icon_base+" "+r+"' onclick=\"jQuery('#"+a.jgrid.jqID(f.p.id)+"').jqGrid('groupingToggle','"+n+"');return false;\"></span>";try{if(a.isArray(l.formatDisplayField)&&a.isFunction(l.formatDisplayField[F.idx])){F.displayValue=l.formatDisplayField[F.idx].call(f,F.displayValue,F.value,f.p.colModel[j[F.idx]],F.idx,l);m=F.displayValue}else{m=f.formatter(n,F.displayValue,j[F.idx],F.value)}}catch(v){m=F.displayValue}var y="";if(a.isFunction(l.groupText[F.idx])){y=l.groupText[F.idx].call(f,m,F.cnt,F.summary)}else{y=a.jgrid.template(l.groupText[F.idx],m,F.cnt,F.summary)}if(!(typeof y==="string"||typeof y==="number")){y=m}if(l.groupSummaryPos[F.idx]==="header"){s+='<tr id="'+n+'"'+(l.groupCollapse&&F.idx>0?' style="display:none;" ':" ")+'role="row" class= "'+i.content+" jqgroup ui-row-"+f.p.direction+" "+h+'"><td style="padding-left:'+(F.idx*12)+'px;"'+q+">"+o+y+"</td>";s+=g(A,0,l.groups,l.groupColumnShow[F.idx]===false?(q===""?2:3):((q==="")?1:2));s+="</tr>"}else{s+='<tr id="'+n+'"'+(l.groupCollapse&&F.idx>0?' style="display:none;" ':" ")+'role="row" class= "'+i.content+" jqgroup ui-row-"+f.p.direction+" "+h+'"><td style="padding-left:'+(F.idx*12)+'px;" colspan="'+(l.groupColumnShow[F.idx]===false?b-1:b)+'">'+o+y+"</td></tr>"}var E=p-1===F.idx;if(E){var x=l.groups[A+1],D,B,G=0,H=F.startRow,w=x!==undefined?x.startRow:l.groups[A].startRow+l.groups[A].cnt;if(l._locgr){G=(d-1)*e;if(G>F.startRow){H=G}}for(D=H;D<w;D++){if(!c[D-G]){break}s+=c[D-G].join("")}if(l.groupSummaryPos[F.idx]!=="header"){var C;if(x!==undefined){for(C=0;C<l.groupField.length;C++){if(x.dataIndex===l.groupField[C]){break}}u=l.groupField.length-C}for(B=0;B<u;B++){if(!t[B]){continue}var z="";if(l.groupCollapse&&!l.showSummaryOnHide){z=' style="display:none;"'}s+="<tr"+z+' jqfootlevel="'+(F.idx-B)+'" role="row" class="'+i.content+" jqfoot ui-row-"+f.p.direction+'">';s+=g(A,B,l.groups,0);s+="</tr>"}u=C}}});a("#"+a.jgrid.jqID(f.p.id)+" tbody:first").append(s);s=null})},groupingGroupBy:function(b,c){return this.each(function(){var d=this;if(typeof b==="string"){b=[b]}var e=d.p.groupingView;d.p.grouping=true;e._locgr=false;if(e.visibiltyOnNextGrouping===undefined){e.visibiltyOnNextGrouping=[]}var f;for(f=0;f<e.groupField.length;f++){if(!e.groupColumnShow[f]&&e.visibiltyOnNextGrouping[f]){a(d).jqGrid("showCol",e.groupField[f])}}for(f=0;f<b.length;f++){e.visibiltyOnNextGrouping[f]=a("#"+a.jgrid.jqID(d.p.id)+"_"+a.jgrid.jqID(b[f])).is(":visible")}d.p.groupingView=a.extend(d.p.groupingView,c||{});e.groupField=b;a(d).trigger("reloadGrid")})},groupingRemove:function(b){return this.each(function(){var c=this;if(b===undefined){b=true}c.p.grouping=false;if(b===true){var d=c.p.groupingView,e;for(e=0;e<d.groupField.length;e++){if(!d.groupColumnShow[e]&&d.visibiltyOnNextGrouping[e]){a(c).jqGrid("showCol",d.groupField)}}a("tr.jqgroup, tr.jqfoot","#"+a.jgrid.jqID(c.p.id)+" tbody:first").remove();a("tr.jqgrow:hidden","#"+a.jgrid.jqID(c.p.id)+" tbody:first").show()}else{a(c).trigger("reloadGrid")}})},groupingCalculations:{handler:function(c,j,b,h,i,f){var d={sum:function(){return parseFloat(j||0)+parseFloat((f[b]||0))},min:function(){if(j===""){return parseFloat(f[b]||0)}return Math.min(parseFloat(j),parseFloat(f[b]||0))},max:function(){if(j===""){return parseFloat(f[b]||0)}return Math.max(parseFloat(j),parseFloat(f[b]||0))},count:function(){if(j===""){j=0}if(f.hasOwnProperty(b)){return j+1}return 0},avg:function(){return d.sum()}};if(!d[c]){throw ("jqGrid Grouping No such method: "+c)}var g=d[c]();if(h!=null){if(i==="fixed"){g=g.toFixed(h)}else{var e=Math.pow(10,h);g=Math.round(g*e)/e}}return g}},setGroupHeaders:function(b){b=a.extend({useColSpanStyle:false,groupHeaders:[]},b||{});return this.each(function(){var C=this,t,p,x=0,k,c,y,g,A,u,n,w,B,s,o,r=C.p.colModel,q=r.length,z=C.grid.headers,f=a("table.ui-jqgrid-htable",C.grid.hDiv),l=f.children("thead").children("tr.ui-jqgrid-labels:last").addClass("jqg-second-row-header"),h=f.children("thead"),j,d=f.find(".jqg-first-row-header"),m=a.jgrid.styleUI[(C.p.styleUI||"jQueryUI")].base;if(!C.p.groupHeader){C.p.groupHeader=[]}C.p.groupHeader.push(b);if(d[0]===undefined){d=a("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto")}else{d.empty()}var e,v=function(G,D){var F=D.length,E;for(E=0;E<F;E++){if(D[E].startColumnName===G){return E}}return -1};a(C).prepend(h);k=a("<tr>",{role:"row"}).addClass("ui-jqgrid-labels jqg-third-row-header");for(t=0;t<q;t++){y=z[t].el;g=a(y);p=r[t];A={height:"0px",width:z[t].width+"px",display:(p.hidden?"none":"")};a("<th>",{role:"gridcell"}).css(A).addClass("ui-first-th-"+C.p.direction).appendTo(d);y.style.width="";u=v(p.name,b.groupHeaders);if(u>=0){n=b.groupHeaders[u];w=n.numberOfColumns;B=n.titleText;o=n.className||"";for(s=0,u=0;u<w&&(t+u<q);u++){if(!r[t+u].hidden){s++}}c=a("<th>").attr({role:"columnheader"}).addClass(m.headerBox+" ui-th-column-header ui-th-"+C.p.direction+" "+o).html(B);if(s>0){c.attr("colspan",String(s))}if(C.p.headertitles){c.attr("title",c.text())}if(s===0){c.hide()}g.before(c);k.append(y);x=w-1}else{if(x===0){if(b.useColSpanStyle){g.attr("rowspan","2")}else{a("<th>",{role:"columnheader"}).addClass(m.headerBox+" ui-th-column-header ui-th-"+C.p.direction).css({display:p.hidden?"none":""}).insertBefore(g);k.append(y)}}else{k.append(y);x--}}}j=a(C).children("thead");j.prepend(d);k.insertAfter(l);f.append(j);if(b.useColSpanStyle){f.find("span.ui-jqgrid-resize").each(function(){var i=a(this).parent();if(i.is(":visible")){this.style.cssText="height: "+i.height()+"px !important; cursor: col-resize;"}});f.find("div.ui-jqgrid-sortable").each(function(){var D=a(this),i=D.parent();if(i.is(":visible")&&i.is(":has(span.ui-jqgrid-resize)")){D.css("top",(i.height()-D.outerHeight())/2-4+"px")}})}e=j.find("tr.jqg-first-row-header");a(C).bind("jqGridResizeStop.setGroupHeaders",function(i,E,D){e.find("th").eq(D)[0].style.width=E+"px"})})},destroyGroupHeader:function(b){if(b===undefined){b=true}return this.each(function(){var d=this,f,m,n,k,e,c,h=d.grid,p=a("table.ui-jqgrid-htable thead",h.hDiv),g=d.p.colModel,j;if(!h){return}a(this).unbind(".setGroupHeaders");f=a("<tr>",{role:"row"}).addClass("ui-jqgrid-labels");k=h.headers;for(m=0,n=k.length;m<n;m++){j=g[m].hidden?"none":"";e=a(k[m].el).width(k[m].width).css("display",j);try{e.removeAttr("rowSpan")}catch(o){e.attr("rowSpan",1)}f.append(e);c=e.children("span.ui-jqgrid-resize");if(c.length>0){c[0].style.height=""}e.children("div")[0].style.top=""}a(p).children("tr.ui-jqgrid-labels").remove();a(p).prepend(f);if(b===true){a(d).jqGrid("setGridParam",{groupHeader:null})}})}})}));