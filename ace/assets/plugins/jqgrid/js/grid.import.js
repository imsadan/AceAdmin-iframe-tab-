(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./grid.utils","./grid.base"],a)}else{a(jQuery)}}(function(a){a.jgrid=a.jgrid||{};a.extend(a.jgrid,{saveState:function(g,h){h=a.extend({useStorage:true,storageType:"localStorage",beforeSetItem:null,compression:false,compressionModule:"LZString",compressionMethod:"compressToUTF16"},h||{});if(!g){return}var f="",c="",i,b=a("#"+g)[0],j;if(!b.grid){return}j=a(b).data("inlineNav");if(j&&b.p.inlineNav){a(b).jqGrid("setGridParam",{_iN:j})}j=a(b).data("filterToolbar");if(j&&b.p.filterToolbar){a(b).jqGrid("setGridParam",{_fT:j})}f=a(b).jqGrid("jqGridExport",{exptype:"jsonstring",ident:"",root:""});a(b.grid.bDiv).find(".ui-jqgrid-btable tr:gt(0)").each(function(k,e){c+=e.outerHTML});if(a.isFunction(h.beforeSetItem)){i=h.beforeSetItem.call(b,f);if(i!=null){f=i}}if(h.compression){if(h.compressionModule){try{i=window[h.compressionModule][h.compressionMethod](f);if(i!=null){f=i;c=window[h.compressionModule][h.compressionMethod](c)}}catch(d){}}}if(h.useStorage&&a.jgrid.isLocalStorage()){try{window[h.storageType].setItem("jqGrid"+b.p.id,f);window[h.storageType].setItem("jqGrid"+b.p.id+"_data",c)}catch(d){if(d.code===22){alert("Local storage limit is over!")}}}return f},loadState:function(l,j,m){m=a.extend({useStorage:true,storageType:"localStorage",clearAfterLoad:false,beforeSetGrid:null,afterSetGrid:null,decompression:false,decompressionModule:"LZString",decompressionMethod:"decompressFromUTF16"},m||{});if(!l){return}var p,r,c=a("#"+l)[0],f,k,h;if(m.useStorage){try{j=window[m.storageType].getItem("jqGrid"+c.id);f=window[m.storageType].getItem("jqGrid"+c.id+"_data")}catch(g){}}if(!j){return}if(m.decompression){if(m.decompressionModule){try{p=window[m.decompressionModule][m.decompressionMethod](j);if(p!=null){j=p;f=window[m.decompressionModule][m.decompressionMethod](f)}}catch(g){}}}p=jqGridUtils.parse(j);if(p&&a.type(p)==="object"){if(c.grid){a.jgrid.gridUnload(l)}if(a.isFunction(m.beforeSetGrid)){r=m.beforeSetGrid(p);if(r&&a.type(r)==="object"){p=r}}var q=function(e){var b;b=e;return b},n={reccount:p.reccount,records:p.records,lastpage:p.lastpage,shrinkToFit:q(p.shrinkToFit),data:q(p.data),datatype:q(p.datatype),grouping:q(p.grouping)};p.shrinkToFit=false;p.data=[];p.datatype="local";p.grouping=false;if(p.inlineNav){k=q(p._iN);p._iN=null;delete p._iN}if(p.filterToolbar){h=q(p._fT);p._fT=null;delete p._fT}var i=a("#"+l).jqGrid(p);i.append(f);i.jqGrid("setGridParam",n);if(p.storeNavOptions&&p.navGrid){i[0].p.navGrid=false;i.jqGrid("navGrid",p.pager,p.navOptions,p.editOptions,p.addOptions,p.delOptions,p.searchOptions,p.viewOptions);if(p.navButtons&&p.navButtons.length){for(var d=0;d<p.navButtons.length;d++){if("sepclass" in p.navButtons[d][1]){i.jqGrid("navSeparatorAdd",p.navButtons[d][0],p.navButtons[d][1])}else{i.jqGrid("navButtonAdd",p.navButtons[d][0],p.navButtons[d][1])}}}}if(p.inlineNav&&k){i.jqGrid("setGridParam",{inlineNav:false});i.jqGrid("inlineNav",p.pager,k)}if(p.filterToolbar&&h){i.jqGrid("setGridParam",{filterToolbar:false});h.restoreFromFilters=true;i.jqGrid("filterToolbar",h)}if(p.frozenColumns){i.jqGrid("setFrozenColumns")}i[0].updatepager(true,true);if(a.isFunction(m.afterSetGrid)){m.afterSetGrid(i)}if(m.clearAfterLoad){window[m.storageType].removeItem("jqGrid"+c.id);window[m.storageType].removeItem("jqGrid"+c.id+"_data")}}else{alert("can not convert to object")}},isGridInStorage:function(f,h){var g={storageType:"localStorage"};g=a.extend(g,h||{});var i,d,b;try{d=window[g.storageType].getItem("jqGrid"+f);b=window[g.storageType].getItem("jqGrid"+f+"_data");i=d!=null&&b!=null&&typeof d==="string"&&typeof b==="string"}catch(c){i=false}return i},setRegional:function(f,k){var j={storageType:"sessionStorage"};j=a.extend(j,k||{});if(!j.regional){return}a.jgrid.saveState(f,j);j.beforeSetGrid=function(e){e.regional=j.regional;e.force_regional=true;return e};a.jgrid.loadState(f,null,j);var c=a("#"+f)[0],g=a(c).jqGrid("getGridParam","colModel"),d=-1,h=a.jgrid.getRegional(c,"nav");a.each(g,function(e){if(this.formatter&&this.formatter==="actions"){d=e;return false}});if(d!==-1&&h){a("#"+f+" tbody tr").each(function(){var e=this.cells[d];a(e).find(".ui-inline-edit").attr("title",h.edittitle);a(e).find(".ui-inline-del").attr("title",h.deltitle);a(e).find(".ui-inline-save").attr("title",h.savetitle);a(e).find(".ui-inline-cancel").attr("title",h.canceltitle)})}try{window[j.storageType].removeItem("jqGrid"+c.id);window[j.storageType].removeItem("jqGrid"+c.id+"_data")}catch(b){}},jqGridImport:function(c,e){e=a.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"root>grid",data:"root>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},e||{});var b=(c.indexOf("#")===0?"":"#")+a.jgrid.jqID(c);var f=function(n,l){var h=a(l.xmlGrid.config,n)[0];var p=a(l.xmlGrid.data,n)[0],i,j,k;if(jqGridUtils.xmlToJSON){i=jqGridUtils.xmlToJSON(h);for(k in i){if(i.hasOwnProperty(k)){j=i[k]}}if(p){var m=i.grid.datatype;i.grid.datatype="xmlstring";i.grid.datastr=n;a(b).jqGrid(j).jqGrid("setGridParam",{datatype:m})}else{setTimeout(function(){a(b).jqGrid(j)},0)}}else{alert("xml2json or parse are not present")}};var d=function(k,l){if(k&&typeof k==="string"){var j=jqGridUtils.parse(k);var h=j[l.jsonGrid.config];var i=j[l.jsonGrid.data];if(i){var m=h.datatype;h.datatype="jsonstring";h.datastr=i;a(b).jqGrid(h).jqGrid("setGridParam",{datatype:m})}else{a(b).jqGrid(h)}}};switch(e.imptype){case"xml":a.ajax(a.extend({url:e.impurl,type:e.mtype,data:e.impData,dataType:"xml",complete:function(i,h){if(h==="success"){f(i.responseXML,e);a(b).triggerHandler("jqGridImportComplete",[i,e]);if(a.isFunction(e.importComplete)){e.importComplete(i)}}i=null}},e.ajaxOptions));break;case"xmlstring":if(e.impstring&&typeof e.impstring==="string"){var g=a.parseXML(e.impstring);if(g){f(g,e);a(b).triggerHandler("jqGridImportComplete",[g,e]);if(a.isFunction(e.importComplete)){e.importComplete(g)}}}break;case"json":a.ajax(a.extend({url:e.impurl,type:e.mtype,data:e.impData,dataType:"json",complete:function(i){try{d(i.responseText,e);a(b).triggerHandler("jqGridImportComplete",[i,e]);if(a.isFunction(e.importComplete)){e.importComplete(i)}}catch(h){}i=null}},e.ajaxOptions));break;case"jsonstring":if(e.impstring&&typeof e.impstring==="string"){d(e.impstring,e);a(b).triggerHandler("jqGridImportComplete",[e.impstring,e]);if(a.isFunction(e.importComplete)){e.importComplete(e.impstring)}}break}}});a.jgrid.extend({jqGridExport:function(b){b=a.extend({exptype:"xmlstring",root:"grid",ident:"\t",addOptions:{}},b||{});var c=null;this.each(function(){if(!this.grid){return}var e,d=a.extend(true,{},a(this).jqGrid("getGridParam"),b.addOptions);if(d.rownumbers){d.colNames.splice(0,1);d.colModel.splice(0,1)}if(d.multiselect){d.colNames.splice(0,1);d.colModel.splice(0,1)}if(d.subGrid){d.colNames.splice(0,1);d.colModel.splice(0,1)}d.knv=null;if(d.treeGrid){for(e in d.treeReader){if(d.treeReader.hasOwnProperty(e)){d.colNames.splice(d.colNames.length-1);d.colModel.splice(d.colModel.length-1)}}}switch(b.exptype){case"xmlstring":c="<"+b.root+">"+jqGridUtils.jsonToXML(d,{xmlDecl:""})+"</"+b.root+">";break;case"jsonstring":c=jqGridUtils.stringify(d);if(b.root){c="{"+b.root+":"+c+"}"}break}});return c},excelExport:function(b){b=a.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},b||{});return this.each(function(){if(!this.grid){return}var e;if(b.exptype==="remote"){var d=a.extend({},this.p.postData);d[b.oper]=b.tag;var c=jQuery.param(d);if(b.url.indexOf("?")!==-1){e=b.url+"&"+c}else{e=b.url+"?"+c}window.location=e}})}})}));