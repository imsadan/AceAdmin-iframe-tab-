(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./grid.base","./grid.common"],a)}else{a(jQuery)}}(function(a){a.jgrid.inlineEdit=a.jgrid.inlineEdit||{};a.jgrid.extend({editRow:function(j,g,i,k,l,f,c,e,b){var h={},d=a.makeArray(arguments).slice(1);if(a.type(d[0])==="object"){h=d[0]}else{if(g!==undefined){h.keys=g}if(a.isFunction(i)){h.oneditfunc=i}if(a.isFunction(k)){h.successfunc=k}if(l!==undefined){h.url=l}if(f!==undefined){h.extraparam=f}if(a.isFunction(c)){h.aftersavefunc=c}if(a.isFunction(e)){h.errorfunc=e}if(a.isFunction(b)){h.afterrestorefunc=b}}h=a.extend(true,{keys:false,keyevent:"keydown",oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:true,mtype:"POST",focusField:true},a.jgrid.inlineEdit,h);return this.each(function(){var m=this,u,w,q,p=0,r=null,v={},s,o,n,t=a(this).jqGrid("getStyleUI",m.p.styleUI+".inlinedit","inputClass",true);if(!m.grid){return}s=a(m).jqGrid("getInd",j,true);if(s===false){return}n=a.isFunction(h.beforeEditRow)?h.beforeEditRow.call(m,h,j):undefined;if(n===undefined){n=true}if(!n){return}q=a(s).attr("editable")||"0";if(q==="0"&&!a(s).hasClass("not-editable-row")){o=m.p.colModel;a('td[role="gridcell"]',s).each(function(z){u=o[z].name;var B=m.p.treeGrid===true&&u===m.p.ExpandColumn;if(B){w=a("span:first",this).html()}else{try{w=a.unformat.call(m,this,{rowId:j,colModel:o[z]},z)}catch(x){w=(o[z].edittype&&o[z].edittype==="textarea")?a(this).text():a(this).html()}}if(u!=="cb"&&u!=="subgrid"&&u!=="rn"){if(m.p.autoencode){w=a.jgrid.htmlDecode(w)}v[u]=w;if(o[z].editable===true){if(r===null){r=z}if(B){a("span:first",this).html("")}else{a(this).html("")}var A=a.extend({},o[z].editoptions||{},{id:j+"_"+u,name:u,rowId:j,oper:"edit"});if(!o[z].edittype){o[z].edittype="text"}if(w==="&nbsp;"||w==="&#160;"||(w.length===1&&w.charCodeAt(0)===160)){w=""}var y=a.jgrid.createEl.call(m,o[z].edittype,A,w,true,a.extend({},a.jgrid.ajaxOptions,m.p.ajaxSelectOptions||{}));a(y).addClass("editable inline-edit-cell");if(a.inArray(o[z].edittype,["text","textarea","password","select"])>-1){a(y).addClass(t)}if(B){a("span:first",this).append(y)}else{a(this).append(y)}a.jgrid.bindEv.call(m,y,A);if(o[z].edittype==="select"&&o[z].editoptions!==undefined&&o[z].editoptions.multiple===true&&o[z].editoptions.dataUrl===undefined&&a.jgrid.msie){a(y).width(a(y).width())}p++}}});if(p>0){v.id=j;m.p.savedRow.push(v);a(s).attr("editable","1");if(h.focusField){if(typeof h.focusField==="number"&&parseInt(h.focusField,10)<=o.length){r=h.focusField}setTimeout(function(){var x=a("td:eq("+r+") :input:visible",s).not(":disabled");if(x.length>0){x.focus()}},0)}if(h.keys===true){a(s).bind(h.keyevent,function(x){if(x.keyCode===27){a(m).jqGrid("restoreRow",j,h.afterrestorefunc);if(m.p.inlineNav){try{a(m).jqGrid("showAddEditButtons")}catch(y){}}return false}if(x.keyCode===13){var A=x.target;if(A.tagName==="TEXTAREA"){return true}if(a(m).jqGrid("saveRow",j,h)){if(m.p.inlineNav){try{a(m).jqGrid("showAddEditButtons")}catch(z){}}}return false}})}a(m).triggerHandler("jqGridInlineEditRow",[j,h]);if(a.isFunction(h.oneditfunc)){h.oneditfunc.call(m,j)}}}})},saveRow:function(H,J,O,s,d,q,c){var f=a.makeArray(arguments).slice(1),B={},b=this[0];if(a.type(f[0])==="object"){B=f[0]}else{if(a.isFunction(J)){B.successfunc=J}if(O!==undefined){B.url=O}if(s!==undefined){B.extraparam=s}if(a.isFunction(d)){B.aftersavefunc=d}if(a.isFunction(q)){B.errorfunc=q}if(a.isFunction(c)){B.afterrestorefunc=c}}B=a.extend(true,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:true,mtype:"POST",saveui:"enable",savetext:a.jgrid.getRegional(b,"defaults.savetext")},a.jgrid.inlineEdit,B);var I=false,z,K={},L={},M={},n,t,j,w,A=false,p=a.trim(a(b).jqGrid("getStyleUI",b.p.styleUI+".common","error",true));if(!b.grid){return I}w=a(b).jqGrid("getInd",H,true);if(w===false){return I}var r=a.jgrid.getRegional(this,"errors"),m=a.jgrid.getRegional(this,"edit"),g=a.isFunction(B.beforeSaveRow)?B.beforeSaveRow.call(b,B,H):undefined;if(g===undefined){g=true}if(!g){return}n=a(w).attr("editable");B.url=B.url||b.p.editurl;if(n==="1"){var h;a('td[role="gridcell"]',w).each(function(P){h=b.p.colModel[P];z=h.name;if(z!=="cb"&&z!=="subgrid"&&h.editable===true&&z!=="rn"&&!a(this).hasClass("not-editable-cell")){switch(h.edittype){case"checkbox":var k=["Yes","No"];if(h.editoptions){k=h.editoptions.value.split(":")}K[z]=a("input",this).is(":checked")?k[0]:k[1];break;case"text":case"password":case"textarea":case"button":K[z]=a("input, textarea",this).val();break;case"select":if(!h.editoptions.multiple){K[z]=a("select option:selected",this).val();L[z]=a("select option:selected",this).text()}else{var Q=a("select",this),R=[];K[z]=a(Q).val();if(K[z]){K[z]=K[z].join(",")}else{K[z]=""}a("select option:selected",this).each(function(e,S){R[e]=a(S).text()});L[z]=R.join(",")}if(h.formatter&&h.formatter==="select"){L={}}break;case"custom":try{if(h.editoptions&&a.isFunction(h.editoptions.custom_value)){K[z]=h.editoptions.custom_value.call(b,a(".customelement",this),"get");if(K[z]===undefined){throw"e2"}}else{throw"e1"}}catch(o){if(o==="e1"){a.jgrid.info_dialog(r.errcap,"function 'custom_value' "+m.msg.nodefined,m.bClose,{styleUI:b.p.styleUI})}else{a.jgrid.info_dialog(r.errcap,o.message,m.bClose,{styleUI:b.p.styleUI})}}break}j=a.jgrid.checkValues.call(b,K[z],P);if(j[0]===false){return false}if(b.p.autoencode){K[z]=a.jgrid.htmlEncode(K[z])}if(B.url!=="clientArray"&&h.editoptions&&h.editoptions.NullIfEmpty===true){if(K[z]===""){M[z]="null";A=true}}}});if(j[0]===false){try{var N=a(b).jqGrid("getGridRowById",H),F=a.jgrid.findPos(N);a.jgrid.info_dialog(r.errcap,j[1],m.bClose,{left:F[0],top:F[1]+a(N).outerHeight(),styleUI:b.p.styleUI})}catch(l){alert(j[1])}return I}var v,E=b.p.prmNames,D=H;if(b.p.keyName===false){v=E.id}else{v=b.p.keyName}if(K){K[E.oper]=E.editoper;if(K[v]===undefined||K[v]===""){K[v]=H}else{if(w.id!==b.p.idPrefix+K[v]){var C=a.jgrid.stripPref(b.p.idPrefix,H);if(b.p._index[C]!==undefined){b.p._index[K[v]]=b.p._index[C];delete b.p._index[C]}H=b.p.idPrefix+K[v];a(w).attr("id",H);if(b.p.selrow===D){b.p.selrow=H}if(a.isArray(b.p.selarrrow)){var u=a.inArray(D,b.p.selarrrow);if(u>=0){b.p.selarrrow[u]=H}}if(b.p.multiselect){var y="jqg_"+b.p.id+"_"+H;a("input.cbox",w).attr("id",y).attr("name",y)}}}if(b.p.inlineData===undefined){b.p.inlineData={}}K=a.extend({},K,b.p.inlineData,B.extraparam)}if(B.url==="clientArray"){K=a.extend({},K,L);if(b.p.autoencode){a.each(K,function(e,i){K[e]=a.jgrid.htmlDecode(i)})}var x,G=a(b).jqGrid("setRowData",H,K);a(w).attr("editable","0");for(x=0;x<b.p.savedRow.length;x++){if(String(b.p.savedRow[x].id)===String(D)){t=x;break}}if(t>=0){b.p.savedRow.splice(t,1)}a(b).triggerHandler("jqGridInlineAfterSaveRow",[H,G,K,B]);if(a.isFunction(B.aftersavefunc)){B.aftersavefunc.call(b,H,G,K,B)}I=true;a(w).removeClass("jqgrid-new-row").unbind("keydown")}else{a(b).jqGrid("progressBar",{method:"show",loadtype:B.saveui,htmlcontent:B.savetext});M=a.extend({},K,M);M[v]=a.jgrid.stripPref(b.p.idPrefix,M[v]);a.ajax(a.extend({url:B.url,data:a.isFunction(b.p.serializeRowData)?b.p.serializeRowData.call(b,M):M,type:B.mtype,async:false,complete:function(i,P){a(b).jqGrid("progressBar",{method:"hide",loadtype:B.saveui,htmlcontent:B.savetext});if(P==="success"){var o=true,Q,e;Q=a(b).triggerHandler("jqGridInlineSuccessSaveRow",[i,H,B]);if(!a.isArray(Q)){Q=[true,M]}if(Q[0]&&a.isFunction(B.successfunc)){Q=B.successfunc.call(b,i)}if(a.isArray(Q)){o=Q[0];K=Q[1]||K}else{o=Q}if(o===true){if(b.p.autoencode){a.each(K,function(k,R){K[k]=a.jgrid.htmlDecode(R)})}if(A){a.each(K,function(k){if(K[k]==="null"){K[k]=""}})}K=a.extend({},K,L);a(b).jqGrid("setRowData",H,K);a(w).attr("editable","0");for(e=0;e<b.p.savedRow.length;e++){if(String(b.p.savedRow[e].id)===String(H)){t=e;break}}if(t>=0){b.p.savedRow.splice(t,1)}a(b).triggerHandler("jqGridInlineAfterSaveRow",[H,i,K,B]);if(a.isFunction(B.aftersavefunc)){B.aftersavefunc.call(b,H,i,K,B)}I=true;a(w).removeClass("jqgrid-new-row").unbind("keydown")}else{a(b).triggerHandler("jqGridInlineErrorSaveRow",[H,i,P,null,B]);if(a.isFunction(B.errorfunc)){B.errorfunc.call(b,H,i,P,null)}if(B.restoreAfterError===true){a(b).jqGrid("restoreRow",H,B.afterrestorefunc)}}}},error:function(o,Q,k){a("#lui_"+a.jgrid.jqID(b.p.id)).hide();a(b).triggerHandler("jqGridInlineErrorSaveRow",[H,o,Q,k,B]);if(a.isFunction(B.errorfunc)){B.errorfunc.call(b,H,o,Q,k)}else{var P=o.responseText||o.statusText;try{a.jgrid.info_dialog(r.errcap,'<div class="'+p+'">'+P+"</div>",m.bClose,{buttonalign:"right",styleUI:b.p.styleUI})}catch(i){alert(P)}}if(B.restoreAfterError===true){a(b).jqGrid("restoreRow",H,B.afterrestorefunc)}}},a.jgrid.ajaxOptions,b.p.ajaxRowOptions||{}))}}return I},restoreRow:function(e,b){var c=a.makeArray(arguments).slice(1),d={};if(a.type(c[0])==="object"){d=c[0]}else{if(a.isFunction(b)){d.afterrestorefunc=b}}d=a.extend(true,{},a.jgrid.inlineEdit,d);return this.each(function(){var f=this,j=-1,l,g={},m;if(!f.grid){return}l=a(f).jqGrid("getInd",e,true);if(l===false){return}var h=a.isFunction(d.beforeCancelRow)?d.beforeCancelRow.call(f,d,e):undefined;if(h===undefined){h=true}if(!h){return}for(m=0;m<f.p.savedRow.length;m++){if(String(f.p.savedRow[m].id)===String(e)){j=m;break}}if(j>=0){if(a.isFunction(a.fn.datepicker)){try{a("input.hasDatepicker","#"+a.jgrid.jqID(l.id)).datepicker("hide")}catch(i){}}a.each(f.p.colModel,function(){if(this.editable===true&&f.p.savedRow[j].hasOwnProperty(this.name)){g[this.name]=f.p.savedRow[j][this.name]}});a(f).jqGrid("setRowData",e,g);a(l).attr("editable","0").unbind("keydown");f.p.savedRow.splice(j,1);if(a("#"+a.jgrid.jqID(e),"#"+a.jgrid.jqID(f.p.id)).hasClass("jqgrid-new-row")){setTimeout(function(){a(f).jqGrid("delRowData",e);a(f).jqGrid("showAddEditButtons")},0)}}a(f).triggerHandler("jqGridInlineAfterRestoreRow",[e]);if(a.isFunction(d.afterrestorefunc)){d.afterrestorefunc.call(f,e)}})},addRow:function(b){b=a.extend(true,{rowID:null,initdata:{},position:"first",useDefValues:true,useFormatter:false,addRowParams:{extraparam:{}}},b||{});return this.each(function(){if(!this.grid){return}var c=this;var d=a.isFunction(b.beforeAddRow)?b.beforeAddRow.call(c,b.addRowParams):undefined;if(d===undefined){d=true}if(!d){return}b.rowID=a.isFunction(b.rowID)?b.rowID.call(c,b):((b.rowID!=null)?b.rowID:a.jgrid.randId());if(b.useDefValues===true){a(c.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var g=this.editoptions.defaultValue,h=a.isFunction(g)?g.call(c):g;b.initdata[this.name]=h}})}a(c).jqGrid("addRowData",b.rowID,b.initdata,b.position);b.rowID=c.p.idPrefix+b.rowID;a("#"+a.jgrid.jqID(b.rowID),"#"+a.jgrid.jqID(c.p.id)).addClass("jqgrid-new-row");if(b.useFormatter){a("#"+a.jgrid.jqID(b.rowID)+" .ui-inline-edit","#"+a.jgrid.jqID(c.p.id)).click()}else{var f=c.p.prmNames,e=f.oper;b.addRowParams.extraparam[e]=f.addoper;a(c).jqGrid("editRow",b.rowID,b.addRowParams);a(c).jqGrid("setSelection",b.rowID)}})},inlineNav:function(c,e){var b=this[0],f=a.jgrid.getRegional(b,"nav"),d=a.jgrid.styleUI[b.p.styleUI].inlinedit;e=a.extend(true,{edit:true,editicon:d.icon_edit_nav,add:true,addicon:d.icon_add_nav,save:true,saveicon:d.icon_save_nav,cancel:true,cancelicon:d.icon_cancel_nav,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:true},f,e||{});return this.each(function(){if(!this.grid||this.p.inlineNav){return}var l=a.jgrid.jqID(b.p.id),k=a.trim(a(b).jqGrid("getStyleUI",b.p.styleUI+".common","disabled",true));if(!b.p.navGrid){a(b).jqGrid("navGrid",c,{refresh:false,edit:false,add:false,del:false,search:false,view:false})}if(!a(b).data("inlineNav")){a(b).data("inlineNav",e)}if(b.p.force_regional){e=a.extend(e,f)}b.p.inlineNav=true;if(e.addParams.useFormatter===true){var h=b.p.colModel,m;for(m=0;m<h.length;m++){if(h[m].formatter&&h[m].formatter==="actions"){if(h[m].formatoptions){var j={keys:false,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},g=a.extend(j,h[m].formatoptions);e.addParams.addRowParams={keys:g.keys,oneditfunc:g.onEdit,successfunc:g.onSuccess,url:g.url,extraparam:g.extraparam,aftersavefunc:g.afterSave,errorfunc:g.onError,afterrestorefunc:g.afterRestore}}break}}}if(e.add){a(b).jqGrid("navButtonAdd",c,{caption:e.addtext,title:e.addtitle,buttonicon:e.addicon,id:b.p.id+"_iladd",internal:true,onClickButton:function(){a(b).jqGrid("addRow",e.addParams);if(!e.addParams.useFormatter){a("#"+l+"_ilsave").removeClass(k);a("#"+l+"_ilcancel").removeClass(k);a("#"+l+"_iladd").addClass(k);a("#"+l+"_iledit").addClass(k)}}})}if(e.edit){a(b).jqGrid("navButtonAdd",c,{caption:e.edittext,title:e.edittitle,buttonicon:e.editicon,id:b.p.id+"_iledit",internal:true,onClickButton:function(){var i=a(b).jqGrid("getGridParam","selrow");if(i){a(b).jqGrid("editRow",i,e.editParams);a("#"+l+"_ilsave").removeClass(k);a("#"+l+"_ilcancel").removeClass(k);a("#"+l+"_iladd").addClass(k);a("#"+l+"_iledit").addClass(k)}else{a.jgrid.viewModal("#alertmod_"+l,{gbox:"#gbox_"+l,jqm:true});a("#jqg_alrt").focus()}}})}if(e.save){a(b).jqGrid("navButtonAdd",c,{caption:e.savetext||"",title:e.savetitle||"Save row",buttonicon:e.saveicon,id:b.p.id+"_ilsave",internal:true,onClickButton:function(){var o=b.p.savedRow[0].id;if(o){var n=b.p.prmNames,i=n.oper,p=e.editParams;if(a("#"+a.jgrid.jqID(o),"#"+l).hasClass("jqgrid-new-row")){e.addParams.addRowParams.extraparam[i]=n.addoper;p=e.addParams.addRowParams}else{if(!e.editParams.extraparam){e.editParams.extraparam={}}e.editParams.extraparam[i]=n.editoper}if(a(b).jqGrid("saveRow",o,p)){a(b).jqGrid("showAddEditButtons")}}else{a.jgrid.viewModal("#alertmod_"+l,{gbox:"#gbox_"+l,jqm:true});a("#jqg_alrt").focus()}}});a("#"+l+"_ilsave").addClass(k)}if(e.cancel){a(b).jqGrid("navButtonAdd",c,{caption:e.canceltext||"",title:e.canceltitle||"Cancel row editing",buttonicon:e.cancelicon,id:b.p.id+"_ilcancel",internal:true,onClickButton:function(){var n=b.p.savedRow[0].id,i=e.editParams;if(n){if(a("#"+a.jgrid.jqID(n),"#"+l).hasClass("jqgrid-new-row")){i=e.addParams.addRowParams}a(b).jqGrid("restoreRow",n,i);a(b).jqGrid("showAddEditButtons")}else{a.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+l,jqm:true});a("#jqg_alrt").focus()}}});a("#"+l+"_ilcancel").addClass(k)}if(e.restoreAfterSelect===true){a(b).bind("jqGridBeforeSelectRow.inlineNav",function(i,n){if(b.p.savedRow.length>0&&b.p.inlineNav===true&&(n!==b.p.selrow&&b.p.selrow!==null)){if(b.p.selrow===e.addParams.rowID){a(b).jqGrid("delRowData",b.p.selrow)}else{a(b).jqGrid("restoreRow",b.p.selrow,e.editParams)}a(b).jqGrid("showAddEditButtons")}})}})},showAddEditButtons:function(){return this.each(function(){if(!this.grid){return}var c=a.jgrid.jqID(this.p.id),b=a.trim(a(this).jqGrid("getStyleUI",this.p.styleUI+".common","disabled",true));a("#"+c+"_ilsave").addClass(b);a("#"+c+"_ilcancel").addClass(b);a("#"+c+"_iladd").removeClass(b);a("#"+c+"_iledit").removeClass(b)})}})}));