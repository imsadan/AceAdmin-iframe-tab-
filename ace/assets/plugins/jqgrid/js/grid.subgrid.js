(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./grid.base"],a)}else{a(jQuery)}}(function(a){a.jgrid.extend({setSubGrid:function(){return this.each(function(){var b=this,d,e,c=a.jgrid.styleUI[(b.p.styleUI||"jQueryUI")].subgrid,f={plusicon:c.icon_plus,minusicon:c.icon_minus,openicon:c.icon_open,expandOnLoad:false,delayOnLoad:50,selectOnExpand:false,selectOnCollapse:false,reloadOnExpand:true};b.p.subGridOptions=a.extend(f,b.p.subGridOptions||{});b.p.colNames.unshift("");b.p.colModel.unshift({name:"subgrid",width:a.jgrid.cell_width?b.p.subGridWidth+b.p.cellLayout:b.p.subGridWidth,sortable:false,resizable:false,hidedlg:true,search:false,fixed:true});d=b.p.subGridModel;if(d[0]){d[0].align=a.extend([],d[0].align||[]);for(e=0;e<d[0].name.length;e++){d[0].align[e]=d[0].align[e]||"left"}}})},addSubGridCell:function(e,d){var f="",b,g,c;this.each(function(){f=this.formatCol(e,d);g=this.p.id;b=this.p.subGridOptions.plusicon;c=a.jgrid.styleUI[(this.p.styleUI||"jQueryUI")].common});return'<td role="gridcell" aria-describedby="'+g+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+f+"><a style='cursor:pointer;' class='ui-sghref'><span class='"+c.icon_base+" "+b+"'></span></a></td>"},addSubGrid:function(b,c){return this.each(function(){var s=this;if(!s.grid){return}var g=a.jgrid.styleUI[(s.p.styleUI||"jQueryUI")].base,j=a.jgrid.styleUI[(s.p.styleUI||"jQueryUI")].common;var p=function(v,i,t){var u=a("<td align='"+s.p.subGridModel[0].align[t]+"'></td>").html(i);a(v).append(u)};var r=function(y,w){var z,u,x,t=a("<table class='"+g.rowTable+" ui-common-table'><tbody></tbody></table>"),A=a("<tr></tr>");for(u=0;u<s.p.subGridModel[0].name.length;u++){z=a("<th class='"+g.headerBox+" ui-th-subgrid ui-th-column ui-th-"+s.p.direction+"'></th>");a(z).html(s.p.subGridModel[0].name[u]);a(z).width(s.p.subGridModel[0].width[u]);a(A).append(z)}a(t).append(A);if(y){x=s.p.xmlReader.subgrid;a(x.root+" "+x.row,y).each(function(){A=a("<tr class='"+j.content+" ui-subtblcell'></tr>");if(x.repeatitems===true){a(x.cell,this).each(function(B){p(A,a(this).text()||"&#160;",B)})}else{var i=s.p.subGridModel[0].mapping||s.p.subGridModel[0].name;if(i){for(u=0;u<i.length;u++){p(A,a(i[u],this).text()||"&#160;",u)}}}a(t).append(A)})}var v=a("table:first",s.grid.bDiv).attr("id")+"_";a("#"+a.jgrid.jqID(v+w)).append(t);s.grid.hDiv.loading=false;a("#load_"+a.jgrid.jqID(s.p.id)).hide();return false};var q=function(C,A){var D,z,w,t,B,x,u=a("<table class='"+g.rowTable+" ui-common-table'><tbody></tbody></table>"),E=a("<tr></tr>");for(w=0;w<s.p.subGridModel[0].name.length;w++){D=a("<th class='"+g.headerBox+" ui-th-subgrid ui-th-column ui-th-"+s.p.direction+"'></th>");a(D).html(s.p.subGridModel[0].name[w]);a(D).width(s.p.subGridModel[0].width[w]);a(E).append(D)}a(u).append(E);if(C){B=s.p.jsonReader.subgrid;z=a.jgrid.getAccessor(C,B.root);if(z!==undefined){for(w=0;w<z.length;w++){t=z[w];E=a("<tr class='"+j.content+" ui-subtblcell'></tr>");if(B.repeatitems===true){if(B.cell){t=t[B.cell]}for(x=0;x<t.length;x++){p(E,t[x]||"&#160;",x)}}else{var v=s.p.subGridModel[0].mapping||s.p.subGridModel[0].name;if(v.length){for(x=0;x<v.length;x++){p(E,t[v[x]]||"&#160;",x)}}}a(u).append(E)}}}var y=a("table:first",s.grid.bDiv).attr("id")+"_";a("#"+a.jgrid.jqID(y+A)).append(u);s.grid.hDiv.loading=false;a("#load_"+a.jgrid.jqID(s.p.id)).hide();return false};var o=function(w){var x,t,u,v;x=a(w).attr("id");t={nd_:(new Date().getTime())};t[s.p.prmNames.subgridid]=x;if(!s.p.subGridModel[0]){return false}if(s.p.subGridModel[0].params){for(v=0;v<s.p.subGridModel[0].params.length;v++){for(u=0;u<s.p.colModel.length;u++){if(s.p.colModel[u].name===s.p.subGridModel[0].params[v]){t[s.p.colModel[u].name]=a("td:eq("+u+")",w).text().replace(/\&#160\;/ig,"")}}}}if(!s.grid.hDiv.loading){s.grid.hDiv.loading=true;a("#load_"+a.jgrid.jqID(s.p.id)).show();if(!s.p.subgridtype){s.p.subgridtype=s.p.datatype}if(a.isFunction(s.p.subgridtype)){s.p.subgridtype.call(s,t)}else{s.p.subgridtype=s.p.subgridtype.toLowerCase()}switch(s.p.subgridtype){case"xml":case"json":a.ajax(a.extend({type:s.p.mtype,url:a.isFunction(s.p.subGridUrl)?s.p.subGridUrl.call(s,t):s.p.subGridUrl,dataType:s.p.subgridtype,data:a.isFunction(s.p.serializeSubGridData)?s.p.serializeSubGridData.call(s,t):t,complete:function(i){if(s.p.subgridtype==="xml"){r(i.responseXML,x)}else{q(a.jgrid.parse(i.responseText),x)}i=null}},a.jgrid.ajaxOptions,s.p.ajaxSubgridOptions||{}));break}}return false};var e,n,f,m=0,h,d;a.each(s.p.colModel,function(){if(this.hidden===true||this.name==="rn"||this.name==="cb"){m++}});var l=s.rows.length,k=1;if(c!==undefined&&c>0){k=c;l=c+1}while(k<l){if(a(s.rows[k]).hasClass("jqgrow")){if(s.p.scroll){a(s.rows[k].cells[b]).unbind("click")}a(s.rows[k].cells[b]).bind("click",function(){var i=a(this).parent("tr")[0];n=s.p.id;e=i.id;d=a("#"+n+"_"+e+"_expandedContent");if(a(this).hasClass("sgcollapsed")){h=a(s).triggerHandler("jqGridSubGridBeforeExpand",[n+"_"+e,e]);h=(h===false||h==="stop")?false:true;if(h&&a.isFunction(s.p.subGridBeforeExpand)){h=s.p.subGridBeforeExpand.call(s,n+"_"+e,e)}if(h===false){return false}if(s.p.subGridOptions.reloadOnExpand===true||(s.p.subGridOptions.reloadOnExpand===false&&!d.hasClass("ui-subgrid"))){f=b>=1?"<td colspan='"+b+"'>&#160;</td>":"";a(i).after("<tr role='row' id='"+n+"_"+e+"_expandedContent' class='ui-subgrid ui-sg-expanded'>"+f+"<td class='"+j.content+" subgrid-cell'><span class='"+j.icon_base+" "+s.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(s.p.colNames.length-1-m,10)+"' class='"+j.content+" subgrid-data'><div id="+n+"_"+e+" class='tablediv'></div></td></tr>");a(s).triggerHandler("jqGridSubGridRowExpanded",[n+"_"+e,e]);if(a.isFunction(s.p.subGridRowExpanded)){s.p.subGridRowExpanded.call(s,n+"_"+e,e)}else{o(i)}}else{d.show().removeClass("ui-sg-collapsed").addClass("ui-sg-expanded")}a(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+j.icon_base+" "+s.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded");if(s.p.subGridOptions.selectOnExpand){a(s).jqGrid("setSelection",e)}}else{if(a(this).hasClass("sgexpanded")){h=a(s).triggerHandler("jqGridSubGridRowColapsed",[n+"_"+e,e]);h=(h===false||h==="stop")?false:true;if(h&&a.isFunction(s.p.subGridRowColapsed)){h=s.p.subGridRowColapsed.call(s,n+"_"+e,e)}if(h===false){return false}if(s.p.subGridOptions.reloadOnExpand===true){d.remove(".ui-subgrid")}else{if(d.hasClass("ui-subgrid")){d.hide().addClass("ui-sg-collapsed").removeClass("ui-sg-expanded")}}a(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+j.icon_base+" "+s.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed");if(s.p.subGridOptions.selectOnCollapse){a(s).jqGrid("setSelection",e)}}}return false})}k++}if(s.p.subGridOptions.expandOnLoad===true){a(s.rows).filter(".jqgrow").each(function(i,t){a(t.cells[0]).click()})}s.subGridXml=function(t,i){r(t,i)};s.subGridJson=function(i,t){q(i,t)}})},expandSubGridRow:function(b){return this.each(function(){var c=this;if(!c.grid&&!b){return}if(c.p.subGrid===true){var d=a(this).jqGrid("getInd",b,true);if(d){var e=a("td.sgcollapsed",d)[0];if(e){a(e).trigger("click")}}}})},collapseSubGridRow:function(b){return this.each(function(){var c=this;if(!c.grid&&!b){return}if(c.p.subGrid===true){var d=a(this).jqGrid("getInd",b,true);if(d){var e=a("td.sgexpanded",d)[0];if(e){a(e).trigger("click")}}}})},toggleSubGridRow:function(b){return this.each(function(){var c=this;if(!c.grid&&!b){return}if(c.p.subGrid===true){var d=a(this).jqGrid("getInd",b,true);if(d){var e=a("td.sgcollapsed",d)[0];if(e){a(e).trigger("click")}else{e=a("td.sgexpanded",d)[0];if(e){a(e).trigger("click")}}}}})}})}));