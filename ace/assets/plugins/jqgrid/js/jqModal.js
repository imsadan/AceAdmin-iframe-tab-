(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(a){a.fn.jqm=function(e){var f={overlay:50,closeoverlay:true,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:g,ajaxText:"",target:g,modal:g,toTop:g,onShow:g,onHide:g,onLoad:g};return this.each(function(){if(this._jqm){return h[this._jqm].c=a.extend({},h[this._jqm].c,e)}l++;this._jqm=l;h[l]={c:a.extend(f,a.jqm.params,e),a:g,w:a(this).addClass("jqmID"+l),s:l};if(f.trigger){a(this).jqmAddTrigger(f.trigger)}})};a.fn.jqmAddClose=function(f){return i(this,f,"jqmHide")};a.fn.jqmAddTrigger=function(f){return i(this,f,"jqmShow")};a.fn.jqmShow=function(e){return this.each(function(){a.jqm.open(this._jqm,e)})};a.fn.jqmHide=function(e){return this.each(function(){a.jqm.close(this._jqm,e)})};a.jqm={hash:{},open:function(q,v){var m=h[q],e=m.c,f="."+e.closeClass,x=(parseInt(m.w.css("z-index")));x=(x>0)?x:3000;var n=a("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":x-1,opacity:e.overlay/100});if(m.a){return g}m.t=v;m.a=true;m.w.css("z-index",x);if(e.modal){if(!b[0]){setTimeout(function(){new j("bind")},1)}b.push(q)}else{if(e.overlay>0){if(e.closeoverlay){m.w.jqmAddClose(n)}}else{n=g}}m.o=(n)?n.addClass(e.overlayClass).prependTo("body"):g;if(e.ajax){var p=e.target||m.w,w=e.ajax;p=(typeof p==="string")?a(p,m.w):a(p);w=(w.substr(0,1)==="@")?a(v).attr(w.substring(1)):w;p.html(e.ajaxText).load(w,function(){if(e.onLoad){e.onLoad.call(this,m)}if(f){m.w.jqmAddClose(a(f,m.w))}c(m)})}else{if(f){m.w.jqmAddClose(a(f,m.w))}}if(e.toTop&&m.o){m.w.before('<span id="jqmP'+m.w[0]._jqm+'"></span>').insertAfter(m.o)}(e.onShow)?e.onShow(m):m.w.show();c(m);return g},close:function(f){var e=h[f];if(!e.a){return g}e.a=g;if(b[0]){b.pop();if(!b[0]){new j("unbind")}}if(e.c.toTop&&e.o){a("#jqmP"+e.w[0]._jqm).after(e.w).remove()}if(e.c.onHide){e.c.onHide(e)}else{e.w.hide();if(e.o){e.o.remove()}}return g},params:{}};var l=0,h=a.jqm.hash,b=[],g=false,c=function(e){if(e.c.focusField===undefined){e.c.focusField=0}if(e.c.focusField>=0){d(e)}},d=function(f){try{a(":input:visible",f.w)[parseInt(f.c.focusField,10)].focus()}catch(e){}},j=function(e){a(document)[e]("keypress",k)[e]("keydown",k)[e]("mousedown",k)},k=function(f){var m=h[b[b.length-1]],n=(!a(f.target).parents(".jqmID"+m.s)[0]);if(n){a(".jqmID"+m.s).each(function(){var e=a(this),o=e.offset();if(o.top<=f.pageY&&f.pageY<=o.top+e.height()&&o.left<=f.pageX&&f.pageX<=o.left+e.width()){n=false;return false}});d(m)}return !n},i=function(m,f,e){return m.each(function(){var n=this._jqm;a(f).each(function(){if(!this[e]){this[e]=[];a(this).click(function(){for(var o in {jqmShow:1,jqmHide:1}){for(var p in this[o]){if(h[this[o][p]]){h[this[o][p]].w[o](this)}}}return g})}this[e].push(n)})})}}));