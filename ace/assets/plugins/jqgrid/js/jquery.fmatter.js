(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./grid.base"],a)}else{a(jQuery)}}(function(a){a.fmatter={};a.extend(a.fmatter,{isBoolean:function(b){return typeof b==="boolean"},isObject:function(b){return(b&&(typeof b==="object"||a.isFunction(b)))||false},isString:function(b){return typeof b==="string"},isNumber:function(b){return typeof b==="number"&&isFinite(b)},isValue:function(b){return(this.isObject(b)||this.isString(b)||this.isNumber(b)||this.isBoolean(b))},isEmpty:function(b){if(!this.isString(b)&&this.isValue(b)){return false}if(!this.isValue(b)){return true}b=a.trim(b).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");return b===""}});a.fn.fmatter=function(e,c,f,g,b){var h=c;f=a.extend({},a.jgrid.getRegional(this,"formatter"),f);try{h=a.fn.fmatter[e].call(this,c,f,g,b)}catch(d){}return h};a.fmatter.util={NumberFormat:function(e,j){if(!a.fmatter.isNumber(e)){e*=1}if(a.fmatter.isNumber(e)){var b=(e<0);var m=String(e);var k=j.decimalSeparator||".";var h;if(a.fmatter.isNumber(j.decimalPlaces)){var g=j.decimalPlaces;var f=Math.pow(10,g);m=String(Math.round(e*f)/f);h=m.lastIndexOf(".");if(g>0){if(h<0){m+=k;h=m.length-1}else{if(k!=="."){m=m.replace(".",k)}}while((m.length-1-h)<g){m+="0"}}}if(j.thousandsSeparator){var n=j.thousandsSeparator;h=m.lastIndexOf(k);h=(h>-1)?h:m.length;var l=m.substring(h);var d=-1,c;for(c=h;c>0;c--){d++;if((d%3===0)&&(c!==h)&&(!b||(c>1))){l=n+l}l=m.charAt(c-1)+l}m=l}m=(j.prefix)?j.prefix+m:m;m=(j.suffix)?m+j.suffix:m;return m}return e}};a.fn.fmatter.defaultFormat=function(b,c){return(a.fmatter.isValue(b)&&b!=="")?b:c.defaultValue||"&#160;"};a.fn.fmatter.email=function(b,c){if(!a.fmatter.isEmpty(b)){return'<a href="mailto:'+b+'">'+b+"</a>"}return a.fn.fmatter.defaultFormat(b,c)};a.fn.fmatter.checkbox=function(c,f){var e=a.extend({},f.checkbox),d;if(f.colModel!==undefined&&f.colModel.formatoptions!==undefined){e=a.extend({},e,f.colModel.formatoptions)}if(e.disabled===true){d='disabled="disabled"'}else{d=""}if(a.fmatter.isEmpty(c)||c===undefined){c=a.fn.fmatter.defaultFormat(c,e)}c=String(c);c=(c+"").toLowerCase();var b=c.search(/(false|f|0|no|n|off|undefined)/i)<0?" checked='checked' ":"";return'<input type="checkbox" '+b+' value="'+c+'" offval="no" '+d+"/>"};a.fn.fmatter.link=function(b,d){var c={target:d.target};var e="";if(d.colModel!==undefined&&d.colModel.formatoptions!==undefined){c=a.extend({},c,d.colModel.formatoptions)}if(c.target){e="target="+c.target}if(!a.fmatter.isEmpty(b)){return"<a "+e+' href="'+b+'">'+b+"</a>"}return a.fn.fmatter.defaultFormat(b,d)};a.fn.fmatter.showlink=function(b,e){var d={baseLinkUrl:e.baseLinkUrl,showAction:e.showAction,addParam:e.addParam||"",target:e.target,idName:e.idName},f="",c;if(e.colModel!==undefined&&e.colModel.formatoptions!==undefined){d=a.extend({},d,e.colModel.formatoptions)}if(d.target){f="target="+d.target}c=d.baseLinkUrl+d.showAction+"?"+d.idName+"="+e.rowId+d.addParam;if(a.fmatter.isString(b)||a.fmatter.isNumber(b)){return"<a "+f+' href="'+c+'">'+b+"</a>"}return a.fn.fmatter.defaultFormat(b,e)};a.fn.fmatter.integer=function(b,d){var c=a.extend({},d.integer);if(d.colModel!==undefined&&d.colModel.formatoptions!==undefined){c=a.extend({},c,d.colModel.formatoptions)}if(a.fmatter.isEmpty(b)){return c.defaultValue}return a.fmatter.util.NumberFormat(b,c)};a.fn.fmatter.number=function(b,d){var c=a.extend({},d.number);if(d.colModel!==undefined&&d.colModel.formatoptions!==undefined){c=a.extend({},c,d.colModel.formatoptions)}if(a.fmatter.isEmpty(b)){return c.defaultValue}return a.fmatter.util.NumberFormat(b,c)};a.fn.fmatter.currency=function(b,d){var c=a.extend({},d.currency);if(d.colModel!==undefined&&d.colModel.formatoptions!==undefined){c=a.extend({},c,d.colModel.formatoptions)}if(a.fmatter.isEmpty(b)){return c.defaultValue}return a.fmatter.util.NumberFormat(b,c)};a.fn.fmatter.date=function(c,e,f,b){var d=a.extend({},e.date);if(e.colModel!==undefined&&e.colModel.formatoptions!==undefined){d=a.extend({},d,e.colModel.formatoptions)}if(!d.reformatAfterEdit&&b==="edit"){return a.fn.fmatter.defaultFormat(c,e)}if(!a.fmatter.isEmpty(c)){return a.jgrid.parseDate.call(this,d.srcformat,c,d.newformat,d)}return a.fn.fmatter.defaultFormat(c,e)};a.fn.fmatter.select=function(b,g){b=String(b);var h=false,k=[],m,c;if(g.colModel.formatoptions!==undefined){h=g.colModel.formatoptions.value;m=g.colModel.formatoptions.separator===undefined?":":g.colModel.formatoptions.separator;c=g.colModel.formatoptions.delimiter===undefined?";":g.colModel.formatoptions.delimiter}else{if(g.colModel.editoptions!==undefined){h=g.colModel.editoptions.value;m=g.colModel.editoptions.separator===undefined?":":g.colModel.editoptions.separator;c=g.colModel.editoptions.delimiter===undefined?";":g.colModel.editoptions.delimiter}}if(h){var f=(g.colModel.editoptions!=null&&g.colModel.editoptions.multiple===true)===true?true:false,l=[],o;if(f){l=b.split(",");l=a.map(l,function(i){return a.trim(i)})}if(a.fmatter.isString(h)){var n=h.split(c),e=0,d;for(d=0;d<n.length;d++){o=n[d].split(m);if(o.length>2){o[1]=a.map(o,function(p,j){if(j>0){return p}}).join(m)}if(f){if(a.inArray(o[0],l)>-1){k[e]=o[1];e++}}else{if(a.trim(o[0])===a.trim(b)){k[0]=o[1];break}}}}else{if(a.fmatter.isObject(h)){if(f){k=a.map(l,function(i){return h[i]})}else{k[0]=h[b]||""}}}}b=k.join(", ");return b===""?a.fn.fmatter.defaultFormat(b,g):b};a.fn.fmatter.rowactions=function(g){var f=a(this).closest("tr.jqgrow"),m=f.attr("id"),d=a(this).closest("table.ui-jqgrid-btable").attr("id").replace(/_frozen([^_]*)$/,"$1"),c=a("#"+d),e=c[0],k=e.p,i=k.colModel[a.jgrid.getCellIndex(this)],b=i.frozen?a("tr#"+m+" td:eq("+a.jgrid.getCellIndex(this)+") > div",c):a(this).parent(),j={extraparam:{}},n=function(p,o){if(a.isFunction(j.afterSave)){j.afterSave.call(e,p,o)}b.find("div.ui-inline-edit,div.ui-inline-del").show();b.find("div.ui-inline-save,div.ui-inline-cancel").hide()},l=function(o){if(a.isFunction(j.afterRestore)){j.afterRestore.call(e,o)}b.find("div.ui-inline-edit,div.ui-inline-del").show();b.find("div.ui-inline-save,div.ui-inline-cancel").hide()};if(i.formatoptions!==undefined){j=a.extend(j,i.formatoptions)}if(k.editOptions!==undefined){j.editOptions=k.editOptions}if(k.delOptions!==undefined){j.delOptions=k.delOptions}if(f.hasClass("jqgrid-new-row")){j.extraparam[k.prmNames.oper]=k.prmNames.addoper}var h={keys:j.keys,oneditfunc:j.onEdit,successfunc:j.onSuccess,url:j.url,extraparam:j.extraparam,aftersavefunc:n,errorfunc:j.onError,afterrestorefunc:l,restoreAfterError:j.restoreAfterError,mtype:j.mtype};switch(g){case"edit":c.jqGrid("editRow",m,h);b.find("div.ui-inline-edit,div.ui-inline-del").hide();b.find("div.ui-inline-save,div.ui-inline-cancel").show();c.triggerHandler("jqGridAfterGridComplete");break;case"save":if(c.jqGrid("saveRow",m,h)){b.find("div.ui-inline-edit,div.ui-inline-del").show();b.find("div.ui-inline-save,div.ui-inline-cancel").hide();c.triggerHandler("jqGridAfterGridComplete")}break;case"cancel":c.jqGrid("restoreRow",m,l);b.find("div.ui-inline-edit,div.ui-inline-del").show();b.find("div.ui-inline-save,div.ui-inline-cancel").hide();c.triggerHandler("jqGridAfterGridComplete");break;case"del":c.jqGrid("delGridRow",m,j.delOptions);break;case"formedit":c.jqGrid("setSelection",m);c.jqGrid("editGridRow",m,j.editOptions);break}};a.fn.fmatter.actions=function(b,i){var h={keys:false,editbutton:true,delbutton:true,editformbutton:false},j=i.rowId,k="",g,f=a.jgrid.getRegional(this,"nav"),c=a.jgrid.styleUI[(i.styleUI||"jQueryUI")].fmatter,d=a.jgrid.styleUI[(i.styleUI||"jQueryUI")].common;if(i.colModel.formatoptions!==undefined){h=a.extend(h,i.colModel.formatoptions)}if(j===undefined||a.fmatter.isEmpty(j)){return""}var e="onmouseover=jQuery(this).addClass('"+d.hover+"'); onmouseout=jQuery(this).removeClass('"+d.hover+"');  ";if(h.editformbutton){g="id='jEditButton_"+j+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'formedit'); "+e;k+="<div title='"+f.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+g+"><span class='"+d.icon_base+" "+c.icon_edit+"'></span></div>"}else{if(h.editbutton){g="id='jEditButton_"+j+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'edit'); "+e;k+="<div title='"+f.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+g+"><span class='"+d.icon_base+" "+c.icon_edit+"'></span></div>"}}if(h.delbutton){g="id='jDeleteButton_"+j+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'del'); "+e;k+="<div title='"+f.deltitle+"' style='float:left;' class='ui-pg-div ui-inline-del' "+g+"><span class='"+d.icon_base+" "+c.icon_del+"'></span></div>"}g="id='jSaveButton_"+j+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'save'); "+e;k+="<div title='"+f.savetitle+"' style='float:left;display:none' class='ui-pg-div ui-inline-save' "+g+"><span class='"+d.icon_base+" "+c.icon_save+"'></span></div>";g="id='jCancelButton_"+j+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'cancel'); "+e;k+="<div title='"+f.canceltitle+"' style='float:left;display:none;' class='ui-pg-div ui-inline-cancel' "+g+"><span class='"+d.icon_base+" "+c.icon_cancel+"'></span></div>";return"<div style='margin-left:8px;'>"+k+"</div>"};a.unformat=function(c,g,i,d){var k,e=g.colModel.formatter,f=g.colModel.formatoptions||{},l,j=/([\.\*\_\'\(\)\{\}\+\?\\])/g,n=g.colModel.unformat||(a.fn.fmatter[e]&&a.fn.fmatter[e].unformat);if(n!==undefined&&a.isFunction(n)){k=n.call(this,a(c).text(),g,c)}else{if(e!==undefined&&a.fmatter.isString(e)){var h=a.jgrid.getRegional(this,"formatter")||{},m;switch(e){case"integer":f=a.extend({},h.integer,f);l=f.thousandsSeparator.replace(j,"\\$1");m=new RegExp(l,"g");k=a(c).text().replace(m,"");break;case"number":f=a.extend({},h.number,f);l=f.thousandsSeparator.replace(j,"\\$1");m=new RegExp(l,"g");k=a(c).text().replace(m,"").replace(f.decimalSeparator,".");break;case"currency":f=a.extend({},h.currency,f);l=f.thousandsSeparator.replace(j,"\\$1");m=new RegExp(l,"g");k=a(c).text();if(f.prefix&&f.prefix.length){k=k.substr(f.prefix.length)}if(f.suffix&&f.suffix.length){k=k.substr(0,k.length-f.suffix.length)}k=k.replace(m,"").replace(f.decimalSeparator,".");break;case"checkbox":var b=(g.colModel.editoptions)?g.colModel.editoptions.value.split(":"):["Yes","No"];k=a("input",c).is(":checked")?b[0]:b[1];break;case"select":k=a.unformat.select(c,g,i,d);break;case"actions":return"";default:k=a(c).text()}}}return k!==undefined?k:d===true?a(c).text():a.jgrid.htmlDecode(a(c).html())};a.unformat.select=function(c,l,n,d){var o=[];var b=a(c).text();if(d===true){return b}var k=a.extend({},l.colModel.formatoptions!==undefined?l.colModel.formatoptions:l.colModel.editoptions),q=k.separator===undefined?":":k.separator,e=k.delimiter===undefined?";":k.delimiter;if(k.value){var m=k.value,h=k.multiple===true?true:false,p=[],s;if(h){p=b.split(",");p=a.map(p,function(i){return a.trim(i)})}if(a.fmatter.isString(m)){var r=m.split(e),g=0,f;for(f=0;f<r.length;f++){s=r[f].split(q);if(s.length>2){s[1]=a.map(s,function(t,j){if(j>0){return t}}).join(q)}if(h){if(a.inArray(a.trim(s[1]),p)>-1){o[g]=s[0];g++}}else{if(a.trim(s[1])===a.trim(b)){o[0]=s[0];break}}}}else{if(a.fmatter.isObject(m)||a.isArray(m)){if(!h){p[0]=b}o=a.map(p,function(i){var j;a.each(m,function(t,u){if(u===i){j=t;return false}});if(j!==undefined){return j}})}}return o.join(", ")}return b||""};a.unformat.date=function(b,d){var c=a.jgrid.getRegional(this,"formatter.date")||{};if(d.formatoptions!==undefined){c=a.extend({},c,d.formatoptions)}if(!a.fmatter.isEmpty(b)){return a.jgrid.parseDate.call(this,c.newformat,b,c.srcformat,c)}return a.fn.fmatter.defaultFormat(b,d)}}));