!function(b){"function"==typeof define&&define.amd?define(["jquery","./grid.base"],b):b(jQuery)}(function(b){b.jgrid.extend({groupingSetup:function(){return this.each(function(){var a,i,j,k=this,l=k.p.colModel,m=k.p.groupingView,n=b.jgrid.styleUI[k.p.styleUI||"jQueryUI"].grouping;if(null===m||"object"!=typeof m&&!b.isFunction(m)){k.p.grouping=!1}else{if(m.plusicon||(m.plusicon=n.icon_plus),m.minusicon||(m.minusicon=n.icon_minus),m.groupField.length){for(void 0===m.visibiltyOnNextGrouping&&(m.visibiltyOnNextGrouping=[]),m.lastvalues=[],m._locgr||(m.groups=[]),m.counters=[],a=0;a<m.groupField.length;a++){m.groupOrder[a]||(m.groupOrder[a]="asc"),m.groupText[a]||(m.groupText[a]="{0}"),"boolean"!=typeof m.groupColumnShow[a]&&(m.groupColumnShow[a]=!0),"boolean"!=typeof m.groupSummary[a]&&(m.groupSummary[a]=!1),m.groupSummaryPos[a]||(m.groupSummaryPos[a]="footer"),m.groupColumnShow[a]===!0?(m.visibiltyOnNextGrouping[a]=!0,b(k).jqGrid("showCol",m.groupField[a])):(m.visibiltyOnNextGrouping[a]=b("#"+b.jgrid.jqID(k.p.id+"_"+m.groupField[a])).is(":visible"),b(k).jqGrid("hideCol",m.groupField[a]))}for(m.summary=[],m.hideFirstGroupCol&&b.isArray(m.formatDisplayField)&&!b.isFunction(m.formatDisplayField[0])&&(m.formatDisplayField[0]=function(c){return c}),i=0,j=l.length;j>i;i++){m.hideFirstGroupCol&&(l[i].hidden||m.groupField[0]!==l[i].name||(l[i].formatter=function(){return""})),l[i].summaryType&&(l[i].summaryDivider?m.summary.push({nm:l[i].name,st:l[i].summaryType,v:"",sd:l[i].summaryDivider,vd:"",sr:l[i].summaryRound,srt:l[i].summaryRoundType||"round"}):m.summary.push({nm:l[i].name,st:l[i].summaryType,v:"",sr:l[i].summaryRound,srt:l[i].summaryRoundType||"round"}))}}else{k.p.grouping=!1}}})},groupingPrepare:function(a,d){return this.each(function(){var c,n,o,p,q,r=this.p.groupingView,s=this,t=function(){b.isFunction(this.st)?this.v=this.st.call(s,this.v,this.nm,a):(this.v=b(s).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,a),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=b(s).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,a)))},u=r.groupField.length,v=0;for(c=0;u>c;c++){n=r.groupField[c],p=r.displayField[c],o=a[n],q=null==p?null:a[p],null==q&&(q=o),void 0!==o&&(0===d?(r.groups.push({idx:c,dataIndex:n,value:o,displayValue:q,startRow:d,cnt:1,summary:[]}),r.lastvalues[c]=o,r.counters[c]={cnt:1,pos:r.groups.length-1,summary:b.extend(!0,[],r.summary)},b.each(r.counters[c].summary,t),r.groups[r.counters[c].pos].summary=r.counters[c].summary):"object"==typeof o||(b.isArray(r.isInTheSameGroup)&&b.isFunction(r.isInTheSameGroup[c])?r.isInTheSameGroup[c].call(s,r.lastvalues[c],o,c,r):r.lastvalues[c]===o)?1===v?(r.groups.push({idx:c,dataIndex:n,value:o,displayValue:q,startRow:d,cnt:1,summary:[]}),r.lastvalues[c]=o,r.counters[c]={cnt:1,pos:r.groups.length-1,summary:b.extend(!0,[],r.summary)},b.each(r.counters[c].summary,t),r.groups[r.counters[c].pos].summary=r.counters[c].summary):(r.counters[c].cnt+=1,r.groups[r.counters[c].pos].cnt=r.counters[c].cnt,b.each(r.counters[c].summary,t),r.groups[r.counters[c].pos].summary=r.counters[c].summary):(r.groups.push({idx:c,dataIndex:n,value:o,displayValue:q,startRow:d,cnt:1,summary:[]}),r.lastvalues[c]=o,v=1,r.counters[c]={cnt:1,pos:r.groups.length-1,summary:b.extend(!0,[],r.summary)},b.each(r.counters[c].summary,t),r.groups[r.counters[c].pos].summary=r.counters[c].summary))}}),this},groupingToggle:function(a){return this.each(function(){var u=this,v=u.p.groupingView,w=a.split("_"),x=parseInt(w[w.length-2],10);w.splice(w.length-2,2);var y,z,A=w.join("_"),B=v.minusicon,C=v.plusicon,D=b("#"+b.jgrid.jqID(a)),E=D.length?D[0].nextSibling:null,F=b("#"+b.jgrid.jqID(a)+" span.tree-wrap-"+u.p.direction),G=function(d){var e=b.map(d.split(" "),function(c){return c.substring(0,A.length+1)===A+"_"?parseInt(c.substring(A.length+1),10):void 0});return e.length>0?e[0]:void 0},H=!1,I=!1,J=u.p.frozenColumns?u.p.id+"_frozen":!1,K=J?b("#"+b.jgrid.jqID(a),"#"+b.jgrid.jqID(J)):!1,L=K&&K.length?K[0].nextSibling:null;if(F.hasClass(B)){if(v.showSummaryOnHide){if(E){for(;E&&(y=G(E.className),!(void 0!==y&&x>=y));){b(E).hide(),E=E.nextSibling,J&&(b(L).hide(),L=L.nextSibling)}}}else{if(E){for(;E&&(y=G(E.className),!(void 0!==y&&x>=y));){b(E).hide(),E=E.nextSibling,J&&(b(L).hide(),L=L.nextSibling)}}}F.removeClass(B).addClass(C),H=!0}else{if(E){for(z=void 0;E;){if(y=G(E.className),void 0===z&&(z=void 0===y),I=b(E).hasClass("ui-subgrid")&&b(E).hasClass("ui-sg-collapsed"),void 0!==y){if(x>=y){break}y===x+1&&(I||(b(E).show().find(">td>span.tree-wrap-"+u.p.direction).removeClass(B).addClass(C),J&&b(L).show().find(">td>span.tree-wrap-"+u.p.direction).removeClass(B).addClass(C)))}else{z&&(I||(b(E).show(),J&&b(L).show()))}E=E.nextSibling,J&&(L=L.nextSibling)}}F.removeClass(C).addClass(B)}b(u).triggerHandler("jqGridGroupingClickGroup",[a,H]),b.isFunction(u.p.onClickGroup)&&u.p.onClickGroup.call(u,a,H)}),!1},groupingRender:function(a,f,g,h){return this.each(function(){function c(i,j,k){var l,m=!1;if(0===j){m=k[i]}else{var n=k[i].idx;if(0===n){m=k[i]}else{for(l=i;l>=0;l--){if(k[l].idx===n-j){m=k[l];break}}}}return m}function d(k,q,r,s){var t,u,I=c(k,q,r),J=x.p.colModel,K=I.cnt,L="";for(u=s;f>u;u++){var M="<td "+x.formatCol(u,1,"")+">&#160;</td>",N="{0}";b.each(I.summary,function(){if(this.nm===J[u].name){J[u].summaryTpl&&(N=J[u].summaryTpl),"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&K>0&&(this.v=this.v/K));try{this.groupCount=I.cnt,this.groupIndex=I.dataIndex,this.groupValue=I.value,t=x.formatter("",this.v,u,this)}catch(i){t=this.v}return M="<td "+x.formatCol(u,1,"")+">"+b.jgrid.template(N,t)+"</td>",!1}}),L+=M}return L}var e,v,w,x=this,y=x.p.groupingView,z="",A="",B=y.groupCollapse?y.plusicon:y.minusicon,C=[],D=y.groupField.length,E=b.jgrid.styleUI[x.p.styleUI||"jQueryUI"].common;B=B+" tree-wrap-"+x.p.direction,b.each(x.p.colModel,function(i,j){var k;for(k=0;D>k;k++){if(y.groupField[k]===j.name){C[k]=i;break}}});var F,G=0,H=b.makeArray(y.groupSummary);H.reverse(),F=x.p.multiselect?' colspan="2"':"",b.each(y.groups,function(n,q){if(y._locgr&&!(q.startRow+q.cnt>(g-1)*h&&q.startRow<g*h)){return !0}G++,v=x.p.id+"ghead_"+q.idx,e=v+"_"+n,A="<span style='cursor:pointer;margin-right:8px;margin-left:5px;' class='"+E.icon_base+" "+B+"' onclick=\"jQuery('#"+b.jgrid.jqID(x.p.id)+"').jqGrid('groupingToggle','"+e+"');return false;\"></span>";try{b.isArray(y.formatDisplayField)&&b.isFunction(y.formatDisplayField[q.idx])?(q.displayValue=y.formatDisplayField[q.idx].call(x,q.displayValue,q.value,x.p.colModel[C[q.idx]],q.idx,y),w=q.displayValue):w=x.formatter(e,q.displayValue,C[q.idx],q.value)}catch(r){w=q.displayValue}var s="";s=b.isFunction(y.groupText[q.idx])?y.groupText[q.idx].call(x,w,q.cnt,q.summary):b.jgrid.template(y.groupText[q.idx],w,q.cnt,q.summary),"string"!=typeof s&&"number"!=typeof s&&(s=w),"header"===y.groupSummaryPos[q.idx]?(z+='<tr id="'+e+'"'+(y.groupCollapse&&q.idx>0?' style="display:none;" ':" ")+'role="row" class= "'+E.content+" jqgroup ui-row-"+x.p.direction+" "+v+'"><td style="padding-left:'+12*q.idx+'px;"'+F+">"+A+s+"</td>",z+=d(n,0,y.groups,y.groupColumnShow[q.idx]===!1?""===F?2:3:""===F?1:2),z+="</tr>"):z+='<tr id="'+e+'"'+(y.groupCollapse&&q.idx>0?' style="display:none;" ':" ")+'role="row" class= "'+E.content+" jqgroup ui-row-"+x.p.direction+" "+v+'"><td style="padding-left:'+12*q.idx+'px;" colspan="'+(y.groupColumnShow[q.idx]===!1?f-1:f)+'">'+A+s+"</td></tr>";var t=D-1===q.idx;if(t){var u,i,j=y.groups[n+1],k=0,l=q.startRow,m=void 0!==j?j.startRow:y.groups[n].startRow+y.groups[n].cnt;for(y._locgr&&(k=(g-1)*h,k>q.startRow&&(l=k)),u=l;m>u&&a[u-k];u++){z+=a[u-k].join("")}if("header"!==y.groupSummaryPos[q.idx]){var o;if(void 0!==j){for(o=0;o<y.groupField.length&&j.dataIndex!==y.groupField[o];o++){}G=y.groupField.length-o}for(i=0;G>i;i++){if(H[i]){var p="";y.groupCollapse&&!y.showSummaryOnHide&&(p=' style="display:none;"'),z+="<tr"+p+' jqfootlevel="'+(q.idx-i)+'" role="row" class="'+E.content+" jqfoot ui-row-"+x.p.direction+'">',z+=d(n,i,y.groups,0),z+="</tr>"}}G=o}}}),b("#"+b.jgrid.jqID(x.p.id)+" tbody:first").append(z),z=null})},groupingGroupBy:function(a,d){return this.each(function(){var c=this;"string"==typeof a&&(a=[a]);var g=c.p.groupingView;c.p.grouping=!0,g._locgr=!1,void 0===g.visibiltyOnNextGrouping&&(g.visibiltyOnNextGrouping=[]);var h;for(h=0;h<g.groupField.length;h++){!g.groupColumnShow[h]&&g.visibiltyOnNextGrouping[h]&&b(c).jqGrid("showCol",g.groupField[h])}for(h=0;h<a.length;h++){g.visibiltyOnNextGrouping[h]=b("#"+b.jgrid.jqID(c.p.id)+"_"+b.jgrid.jqID(a[h])).is(":visible")}c.p.groupingView=b.extend(c.p.groupingView,d||{}),g.groupField=a,b(c).trigger("reloadGrid")})},groupingRemove:function(a){return this.each(function(){var f=this;if(void 0===a&&(a=!0),f.p.grouping=!1,a===!0){var g,h=f.p.groupingView;for(g=0;g<h.groupField.length;g++){!h.groupColumnShow[g]&&h.visibiltyOnNextGrouping[g]&&b(f).jqGrid("showCol",h.groupField)}b("tr.jqgroup, tr.jqfoot","#"+b.jgrid.jqID(f.p.id)+" tbody:first").remove(),b("tr.jqgrow:hidden","#"+b.jgrid.jqID(f.p.id)+" tbody:first").show()}else{b(f).trigger("reloadGrid")}})},groupingCalculations:{handler:function(j,k,l,m,n,o){var p={sum:function(){return parseFloat(k||0)+parseFloat(o[l]||0)},min:function(){return""===k?parseFloat(o[l]||0):Math.min(parseFloat(k),parseFloat(o[l]||0))},max:function(){return""===k?parseFloat(o[l]||0):Math.max(parseFloat(k),parseFloat(o[l]||0))},count:function(){return""===k&&(k=0),o.hasOwnProperty(l)?k+1:0},avg:function(){return p.sum()}};if(!p[j]){throw"jqGrid Grouping No such method: "+j}var q=p[j]();if(null!=m){if("fixed"===n){q=q.toFixed(m)}else{var r=Math.pow(10,m);q=Math.round(q*r)/r}}return q}},setGroupHeaders:function(a){return a=b.extend({useColSpanStyle:!1,groupHeaders:[]},a||{}),this.each(function(){var E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S=this,T=0,U=S.p.colModel,V=U.length,W=S.grid.headers,X=b("table.ui-jqgrid-htable",S.grid.hDiv),Y=X.children("thead").children("tr.ui-jqgrid-labels:last").addClass("jqg-second-row-header"),Z=X.children("thead"),aa=X.find(".jqg-first-row-header"),ab=b.jgrid.styleUI[S.p.styleUI||"jQueryUI"].base;S.p.groupHeader||(S.p.groupHeader=[]),S.p.groupHeader.push(a),void 0===aa[0]?aa=b("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto"):aa.empty();var C,D=function(e,f){var g,h=f.length;for(g=0;h>g;g++){if(f[g].startColumnName===e){return g}}return -1};for(b(S).prepend(Z),G=b("<tr>",{role:"row"}).addClass("ui-jqgrid-labels jqg-third-row-header"),E=0;V>E;E++){if(I=W[E].el,J=b(I),F=U[E],K={height:"0px",width:W[E].width+"px",display:F.hidden?"none":""},b("<th>",{role:"gridcell"}).css(K).addClass("ui-first-th-"+S.p.direction).appendTo(aa),I.style.width="",L=D(F.name,a.groupHeaders),L>=0){for(M=a.groupHeaders[L],N=M.numberOfColumns,O=M.titleText,Q=M.className||"",P=0,L=0;N>L&&V>E+L;L++){U[E+L].hidden||P++}H=b("<th>").attr({role:"columnheader"}).addClass(ab.headerBox+" ui-th-column-header ui-th-"+S.p.direction+" "+Q).html(O),P>0&&H.attr("colspan",String(P)),S.p.headertitles&&H.attr("title",H.text()),0===P&&H.hide(),J.before(H),G.append(I),T=N-1}else{0===T?a.useColSpanStyle?J.attr("rowspan","2"):(b("<th>",{role:"columnheader"}).addClass(ab.headerBox+" ui-th-column-header ui-th-"+S.p.direction).css({display:F.hidden?"none":""}).insertBefore(J),G.append(I)):(G.append(I),T--)}}R=b(S).children("thead"),R.prepend(aa),G.insertAfter(Y),X.append(R),a.useColSpanStyle&&(X.find("span.ui-jqgrid-resize").each(function(){var c=b(this).parent();c.is(":visible")&&(this.style.cssText="height: "+c.height()+"px !important; cursor: col-resize;")}),X.find("div.ui-jqgrid-sortable").each(function(){var d=b(this),e=d.parent();e.is(":visible")&&e.is(":has(span.ui-jqgrid-resize)")&&d.css("top",(e.height()-d.outerHeight())/2-4+"px")})),C=R.find("tr.jqg-first-row-header"),b(S).bind("jqGridResizeStop.setGroupHeaders",function(d,e,f){C.find("th").eq(f)[0].style.width=e+"px"})})},destroyGroupHeader:function(a){return void 0===a&&(a=!0),this.each(function(){var o,p,q,r,s,t,u,v=this,w=v.grid,x=b("table.ui-jqgrid-htable thead",w.hDiv),y=v.p.colModel;if(w){for(b(this).unbind(".setGroupHeaders"),o=b("<tr>",{role:"row"}).addClass("ui-jqgrid-labels"),r=w.headers,p=0,q=r.length;q>p;p++){u=y[p].hidden?"none":"",s=b(r[p].el).width(r[p].width).css("display",u);try{s.removeAttr("rowSpan")}catch(z){s.attr("rowSpan",1)}o.append(s),t=s.children("span.ui-jqgrid-resize"),t.length>0&&(t[0].style.height=""),s.children("div")[0].style.top=""}b(x).children("tr.ui-jqgrid-labels").remove(),b(x).prepend(o),a===!0&&b(v).jqGrid("setGridParam",{groupHeader:null})}})}})});