!function(b){"function"==typeof define&&define.amd?define(["jquery","./grid.utils","./grid.base"],b):b(jQuery)}(function(b){b.jgrid=b.jgrid||{},b.extend(b.jgrid,{saveState:function(a,j){if(j=b.extend({useStorage:!0,storageType:"localStorage",beforeSetItem:null,compression:!1,compressionModule:"LZString",compressionMethod:"compressToUTF16"},j||{}),a){var k,l,m="",n="",o=b("#"+a)[0];if(o.grid){if(l=b(o).data("inlineNav"),l&&o.p.inlineNav&&b(o).jqGrid("setGridParam",{_iN:l}),l=b(o).data("filterToolbar"),l&&o.p.filterToolbar&&b(o).jqGrid("setGridParam",{_fT:l}),m=b(o).jqGrid("jqGridExport",{exptype:"jsonstring",ident:"",root:""}),b(o.grid.bDiv).find(".ui-jqgrid-btable tr:gt(0)").each(function(c,d){n+=d.outerHTML}),b.isFunction(j.beforeSetItem)&&(k=j.beforeSetItem.call(o,m),null!=k&&(m=k)),j.compression&&j.compressionModule){try{k=window[j.compressionModule][j.compressionMethod](m),null!=k&&(m=k,n=window[j.compressionModule][j.compressionMethod](n))}catch(p){}}if(j.useStorage&&b.jgrid.isLocalStorage()){try{window[j.storageType].setItem("jqGrid"+o.p.id,m),window[j.storageType].setItem("jqGrid"+o.p.id+"_data",n)}catch(p){22===p.code&&alert("Local storage limit is over!")}}return m}}},loadState:function(a,p,q){if(q=b.extend({useStorage:!0,storageType:"localStorage",clearAfterLoad:!1,beforeSetGrid:null,afterSetGrid:null,decompression:!1,decompressionModule:"LZString",decompressionMethod:"decompressFromUTF16"},q||{}),a){var r,s,t,u,v,w=b("#"+a)[0];if(q.useStorage){try{p=window[q.storageType].getItem("jqGrid"+w.id),t=window[q.storageType].getItem("jqGrid"+w.id+"_data")}catch(x){}}if(p){if(q.decompression&&q.decompressionModule){try{r=window[q.decompressionModule][q.decompressionMethod](p),null!=r&&(p=r,t=window[q.decompressionModule][q.decompressionMethod](t))}catch(x){}}if(r=jqGridUtils.parse(p),r&&"object"===b.type(r)){w.grid&&b.jgrid.gridUnload(a),b.isFunction(q.beforeSetGrid)&&(s=q.beforeSetGrid(r),s&&"object"===b.type(s)&&(r=s));var y=function(c){var d;return d=c},z={reccount:r.reccount,records:r.records,lastpage:r.lastpage,shrinkToFit:y(r.shrinkToFit),data:y(r.data),datatype:y(r.datatype),grouping:y(r.grouping)};r.shrinkToFit=!1,r.data=[],r.datatype="local",r.grouping=!1,r.inlineNav&&(u=y(r._iN),r._iN=null,delete r._iN),r.filterToolbar&&(v=y(r._fT),r._fT=null,delete r._fT);var A=b("#"+a).jqGrid(r);if(A.append(t),A.jqGrid("setGridParam",z),r.storeNavOptions&&r.navGrid&&(A[0].p.navGrid=!1,A.jqGrid("navGrid",r.pager,r.navOptions,r.editOptions,r.addOptions,r.delOptions,r.searchOptions,r.viewOptions),r.navButtons&&r.navButtons.length)){for(var B=0;B<r.navButtons.length;B++){"sepclass" in r.navButtons[B][1]?A.jqGrid("navSeparatorAdd",r.navButtons[B][0],r.navButtons[B][1]):A.jqGrid("navButtonAdd",r.navButtons[B][0],r.navButtons[B][1])}}r.inlineNav&&u&&(A.jqGrid("setGridParam",{inlineNav:!1}),A.jqGrid("inlineNav",r.pager,u)),r.filterToolbar&&v&&(A.jqGrid("setGridParam",{filterToolbar:!1}),v.restoreFromFilters=!0,A.jqGrid("filterToolbar",v)),r.frozenColumns&&A.jqGrid("setFrozenColumns"),A[0].updatepager(!0,!0),b.isFunction(q.afterSetGrid)&&q.afterSetGrid(A),q.clearAfterLoad&&(window[q.storageType].removeItem("jqGrid"+w.id),window[q.storageType].removeItem("jqGrid"+w.id+"_data"))}else{alert("can not convert to object")}}}},isGridInStorage:function(a,i){var j={storageType:"localStorage"};j=b.extend(j,i||{});var k,l,m;try{l=window[j.storageType].getItem("jqGrid"+a),m=window[j.storageType].getItem("jqGrid"+a+"_data"),k=null!=l&&null!=m&&"string"==typeof l&&"string"==typeof m}catch(n){k=!1}return k},setRegional:function(a,j){var k={storageType:"sessionStorage"};if(k=b.extend(k,j||{}),k.regional){b.jgrid.saveState(a,k),k.beforeSetGrid=function(c){return c.regional=k.regional,c.force_regional=!0,c},b.jgrid.loadState(a,null,k);var l=b("#"+a)[0],m=b(l).jqGrid("getGridParam","colModel"),n=-1,o=b.jgrid.getRegional(l,"nav");b.each(m,function(c){return this.formatter&&"actions"===this.formatter?(n=c,!1):void 0}),-1!==n&&o&&b("#"+a+" tbody tr").each(function(){var c=this.cells[n];b(c).find(".ui-inline-edit").attr("title",o.edittitle),b(c).find(".ui-inline-del").attr("title",o.deltitle),b(c).find(".ui-inline-save").attr("title",o.savetitle),b(c).find(".ui-inline-cancel").attr("title",o.canceltitle)});try{window[k.storageType].removeItem("jqGrid"+l.id),window[k.storageType].removeItem("jqGrid"+l.id+"_data")}catch(p){}}},jqGridImport:function(a,h){h=b.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"root>grid",data:"root>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},h||{});var i=(0===a.indexOf("#")?"":"#")+b.jgrid.jqID(a),j=function(d,m){var n,o,p,q=b(m.xmlGrid.config,d)[0],r=b(m.xmlGrid.data,d)[0];if(jqGridUtils.xmlToJSON){n=jqGridUtils.xmlToJSON(q);for(p in n){n.hasOwnProperty(p)&&(o=n[p])}if(r){var s=n.grid.datatype;n.grid.datatype="xmlstring",n.grid.datastr=d,b(i).jqGrid(o).jqGrid("setGridParam",{datatype:s})}else{setTimeout(function(){b(i).jqGrid(o)},0)}}else{alert("xml2json or parse are not present")}},k=function(d,m){if(d&&"string"==typeof d){var n=jqGridUtils.parse(d),o=n[m.jsonGrid.config],p=n[m.jsonGrid.data];if(p){var q=o.datatype;o.datatype="jsonstring",o.datastr=p,b(i).jqGrid(o).jqGrid("setGridParam",{datatype:q})}else{b(i).jqGrid(o)}}};switch(h.imptype){case"xml":b.ajax(b.extend({url:h.impurl,type:h.mtype,data:h.impData,dataType:"xml",complete:function(c,d){"success"===d&&(j(c.responseXML,h),b(i).triggerHandler("jqGridImportComplete",[c,h]),b.isFunction(h.importComplete)&&h.importComplete(c)),c=null}},h.ajaxOptions));break;case"xmlstring":if(h.impstring&&"string"==typeof h.impstring){var l=b.parseXML(h.impstring);l&&(j(l,h),b(i).triggerHandler("jqGridImportComplete",[l,h]),b.isFunction(h.importComplete)&&h.importComplete(l))}break;case"json":b.ajax(b.extend({url:h.impurl,type:h.mtype,data:h.impData,dataType:"json",complete:function(c){try{k(c.responseText,h),b(i).triggerHandler("jqGridImportComplete",[c,h]),b.isFunction(h.importComplete)&&h.importComplete(c)}catch(d){}c=null}},h.ajaxOptions));break;case"jsonstring":h.impstring&&"string"==typeof h.impstring&&(k(h.impstring,h),b(i).triggerHandler("jqGridImportComplete",[h.impstring,h]),b.isFunction(h.importComplete)&&h.importComplete(h.impstring))}}}),b.jgrid.extend({jqGridExport:function(a){a=b.extend({exptype:"xmlstring",root:"grid",ident:"	",addOptions:{}},a||{});var d=null;return this.each(function(){if(this.grid){var c,f=b.extend(!0,{},b(this).jqGrid("getGridParam"),a.addOptions);if(f.rownumbers&&(f.colNames.splice(0,1),f.colModel.splice(0,1)),f.multiselect&&(f.colNames.splice(0,1),f.colModel.splice(0,1)),f.subGrid&&(f.colNames.splice(0,1),f.colModel.splice(0,1)),f.knv=null,f.treeGrid){for(c in f.treeReader){f.treeReader.hasOwnProperty(c)&&(f.colNames.splice(f.colNames.length-1),f.colModel.splice(f.colModel.length-1))}}switch(a.exptype){case"xmlstring":d="<"+a.root+">"+jqGridUtils.jsonToXML(f,{xmlDecl:""})+"</"+a.root+">";break;case"jsonstring":d=jqGridUtils.stringify(f),a.root&&(d="{"+a.root+":"+d+"}")}}}),d},excelExport:function(a){return a=b.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},a||{}),this.each(function(){if(this.grid){var f;if("remote"===a.exptype){var g=b.extend({},this.p.postData);g[a.oper]=a.tag;var h=jQuery.param(g);f=-1!==a.url.indexOf("?")?a.url+"&"+h:a.url+"?"+h,window.location=f}}})}})});