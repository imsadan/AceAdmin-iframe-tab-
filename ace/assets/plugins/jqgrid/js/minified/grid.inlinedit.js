!function(b){"function"==typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],b):b(jQuery)}(function(b){b.jgrid.inlineEdit=b.jgrid.inlineEdit||{},b.jgrid.extend({editRow:function(a,m,n,o,p,q,r,s,t){var u={},v=b.makeArray(arguments).slice(1);return"object"===b.type(v[0])?u=v[0]:(void 0!==m&&(u.keys=m),b.isFunction(n)&&(u.oneditfunc=n),b.isFunction(o)&&(u.successfunc=o),void 0!==p&&(u.url=p),void 0!==q&&(u.extraparam=q),b.isFunction(r)&&(u.aftersavefunc=r),b.isFunction(s)&&(u.errorfunc=s),b.isFunction(t)&&(u.afterrestorefunc=t)),u=b.extend(!0,{keys:!1,keyevent:"keydown",oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST",focusField:!0},b.jgrid.inlineEdit,u),this.each(function(){var k,w,x,y,z,A,B=this,C=0,D=null,E={},F=b(this).jqGrid("getStyleUI",B.p.styleUI+".inlinedit","inputClass",!0);B.grid&&(y=b(B).jqGrid("getInd",a,!0),y!==!1&&(A=b.isFunction(u.beforeEditRow)?u.beforeEditRow.call(B,u,a):void 0,void 0===A&&(A=!0),A&&(x=b(y).attr("editable")||"0","0"!==x||b(y).hasClass("not-editable-row")||(z=B.p.colModel,b('td[role="gridcell"]',y).each(function(c){k=z[c].name;var d=B.p.treeGrid===!0&&k===B.p.ExpandColumn;if(d){w=b("span:first",this).html()}else{try{w=b.unformat.call(B,this,{rowId:a,colModel:z[c]},c)}catch(g){w=z[c].edittype&&"textarea"===z[c].edittype?b(this).text():b(this).html()}}if("cb"!==k&&"subgrid"!==k&&"rn"!==k&&(B.p.autoencode&&(w=b.jgrid.htmlDecode(w)),E[k]=w,z[c].editable===!0)){null===D&&(D=c),d?b("span:first",this).html(""):b(this).html("");var i=b.extend({},z[c].editoptions||{},{id:a+"_"+k,name:k,rowId:a,oper:"edit"});z[c].edittype||(z[c].edittype="text"),("&nbsp;"===w||"&#160;"===w||1===w.length&&160===w.charCodeAt(0))&&(w="");var j=b.jgrid.createEl.call(B,z[c].edittype,i,w,!0,b.extend({},b.jgrid.ajaxOptions,B.p.ajaxSelectOptions||{}));b(j).addClass("editable inline-edit-cell"),b.inArray(z[c].edittype,["text","textarea","password","select"])>-1&&b(j).addClass(F),d?b("span:first",this).append(j):b(this).append(j),b.jgrid.bindEv.call(B,j,i),"select"===z[c].edittype&&void 0!==z[c].editoptions&&z[c].editoptions.multiple===!0&&void 0===z[c].editoptions.dataUrl&&b.jgrid.msie&&b(j).width(b(j).width()),C++}}),C>0&&(E.id=a,B.p.savedRow.push(E),b(y).attr("editable","1"),u.focusField&&("number"==typeof u.focusField&&parseInt(u.focusField,10)<=z.length&&(D=u.focusField),setTimeout(function(){var c=b("td:eq("+D+") :input:visible",y).not(":disabled");c.length>0&&c.focus()},0)),u.keys===!0&&b(y).bind(u.keyevent,function(g){if(27===g.keyCode){if(b(B).jqGrid("restoreRow",a,u.afterrestorefunc),B.p.inlineNav){try{b(B).jqGrid("showAddEditButtons")}catch(h){}}return !1}if(13===g.keyCode){var i=g.target;if("TEXTAREA"===i.tagName){return !0}if(b(B).jqGrid("saveRow",a,u)&&B.p.inlineNav){try{b(B).jqGrid("showAddEditButtons")}catch(j){}}return !1}}),b(B).triggerHandler("jqGridInlineEditRow",[a,u]),b.isFunction(u.oneditfunc)&&u.oneditfunc.call(B,a))))))})},saveRow:function(L,N,P,R,T,V,X){var Z=b.makeArray(arguments).slice(1),ab={},ad=this[0];"object"===b.type(Z[0])?ab=Z[0]:(b.isFunction(N)&&(ab.successfunc=N),void 0!==P&&(ab.url=P),void 0!==R&&(ab.extraparam=R),b.isFunction(T)&&(ab.aftersavefunc=T),b.isFunction(V)&&(ab.errorfunc=V),b.isFunction(X)&&(ab.afterrestorefunc=X)),ab=b.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST",saveui:"enable",savetext:b.jgrid.getRegional(ad,"defaults.savetext")},b.jgrid.inlineEdit,ab);var af,ag,ah,ai,aj,ak=!1,al={},am={},an={},ao=!1,ap=b.trim(b(ad).jqGrid("getStyleUI",ad.p.styleUI+".common","error",!0));if(!ad.grid){return ak}if(aj=b(ad).jqGrid("getInd",L,!0),aj===!1){return ak}var aq=b.jgrid.getRegional(this,"errors"),ar=b.jgrid.getRegional(this,"edit"),at=b.isFunction(ab.beforeSaveRow)?ab.beforeSaveRow.call(ad,ab,L):void 0;if(void 0===at&&(at=!0),at){if(ag=b(aj).attr("editable"),ab.url=ab.url||ad.p.editurl,"1"===ag){var au;if(b('td[role="gridcell"]',aj).each(function(g){if(au=ad.p.colModel[g],af=au.name,"cb"!==af&&"subgrid"!==af&&au.editable===!0&&"rn"!==af&&!b(this).hasClass("not-editable-cell")){switch(au.edittype){case"checkbox":var h=["Yes","No"];au.editoptions&&(h=au.editoptions.value.split(":")),al[af]=b("input",this).is(":checked")?h[0]:h[1];break;case"text":case"password":case"textarea":case"button":al[af]=b("input, textarea",this).val();break;case"select":if(au.editoptions.multiple){var i=b("select",this),j=[];al[af]=b(i).val(),al[af]?al[af]=al[af].join(","):al[af]="",b("select option:selected",this).each(function(d,e){j[d]=b(e).text()}),am[af]=j.join(",")}else{al[af]=b("select option:selected",this).val(),am[af]=b("select option:selected",this).text()}au.formatter&&"select"===au.formatter&&(am={});break;case"custom":try{if(!au.editoptions||!b.isFunction(au.editoptions.custom_value)){throw"e1"}if(al[af]=au.editoptions.custom_value.call(ad,b(".customelement",this),"get"),void 0===al[af]){throw"e2"}}catch(k){"e1"===k?b.jgrid.info_dialog(aq.errcap,"function 'custom_value' "+ar.msg.nodefined,ar.bClose,{styleUI:ad.p.styleUI}):b.jgrid.info_dialog(aq.errcap,k.message,ar.bClose,{styleUI:ad.p.styleUI})}}if(ai=b.jgrid.checkValues.call(ad,al[af],g),ai[0]===!1){return !1}ad.p.autoencode&&(al[af]=b.jgrid.htmlEncode(al[af])),"clientArray"!==ab.url&&au.editoptions&&au.editoptions.NullIfEmpty===!0&&""===al[af]&&(an[af]="null",ao=!0)}}),ai[0]===!1){try{var a=b(ad).jqGrid("getGridRowById",L),M=b.jgrid.findPos(a);b.jgrid.info_dialog(aq.errcap,ai[1],ar.bClose,{left:M[0],top:M[1]+b(a).outerHeight(),styleUI:ad.p.styleUI})}catch(O){alert(ai[1])}return ak}var Q,S=ad.p.prmNames,U=L;if(Q=ad.p.keyName===!1?S.id:ad.p.keyName,al){if(al[S.oper]=S.editoper,void 0===al[Q]||""===al[Q]){al[Q]=L}else{if(aj.id!==ad.p.idPrefix+al[Q]){var W=b.jgrid.stripPref(ad.p.idPrefix,L);if(void 0!==ad.p._index[W]&&(ad.p._index[al[Q]]=ad.p._index[W],delete ad.p._index[W]),L=ad.p.idPrefix+al[Q],b(aj).attr("id",L),ad.p.selrow===U&&(ad.p.selrow=L),b.isArray(ad.p.selarrrow)){var Y=b.inArray(U,ad.p.selarrrow);Y>=0&&(ad.p.selarrrow[Y]=L)}if(ad.p.multiselect){var aa="jqg_"+ad.p.id+"_"+L;b("input.cbox",aj).attr("id",aa).attr("name",aa)}}}void 0===ad.p.inlineData&&(ad.p.inlineData={}),al=b.extend({},al,ad.p.inlineData,ab.extraparam)}if("clientArray"===ab.url){al=b.extend({},al,am),ad.p.autoencode&&b.each(al,function(d,e){al[d]=b.jgrid.htmlDecode(e)});var ac,ae=b(ad).jqGrid("setRowData",L,al);for(b(aj).attr("editable","0"),ac=0;ac<ad.p.savedRow.length;ac++){if(String(ad.p.savedRow[ac].id)===String(U)){ah=ac;break}}ah>=0&&ad.p.savedRow.splice(ah,1),b(ad).triggerHandler("jqGridInlineAfterSaveRow",[L,ae,al,ab]),b.isFunction(ab.aftersavefunc)&&ab.aftersavefunc.call(ad,L,ae,al,ab),ak=!0,b(aj).removeClass("jqgrid-new-row").unbind("keydown")}else{b(ad).jqGrid("progressBar",{method:"show",loadtype:ab.saveui,htmlcontent:ab.savetext}),an=b.extend({},al,an),an[Q]=b.jgrid.stripPref(ad.p.idPrefix,an[Q]),b.ajax(b.extend({url:ab.url,data:b.isFunction(ad.p.serializeRowData)?ad.p.serializeRowData.call(ad,an):an,type:ab.mtype,async:!1,complete:function(h,i){if(b(ad).jqGrid("progressBar",{method:"hide",loadtype:ab.saveui,htmlcontent:ab.savetext}),"success"===i){var j,k,l=!0;if(j=b(ad).triggerHandler("jqGridInlineSuccessSaveRow",[h,L,ab]),b.isArray(j)||(j=[!0,an]),j[0]&&b.isFunction(ab.successfunc)&&(j=ab.successfunc.call(ad,h)),b.isArray(j)?(l=j[0],al=j[1]||al):l=j,l===!0){for(ad.p.autoencode&&b.each(al,function(d,e){al[d]=b.jgrid.htmlDecode(e)}),ao&&b.each(al,function(c){"null"===al[c]&&(al[c]="")}),al=b.extend({},al,am),b(ad).jqGrid("setRowData",L,al),b(aj).attr("editable","0"),k=0;k<ad.p.savedRow.length;k++){if(String(ad.p.savedRow[k].id)===String(L)){ah=k;break}}ah>=0&&ad.p.savedRow.splice(ah,1),b(ad).triggerHandler("jqGridInlineAfterSaveRow",[L,h,al,ab]),b.isFunction(ab.aftersavefunc)&&ab.aftersavefunc.call(ad,L,h,al,ab),ak=!0,b(aj).removeClass("jqgrid-new-row").unbind("keydown")}else{b(ad).triggerHandler("jqGridInlineErrorSaveRow",[L,h,i,null,ab]),b.isFunction(ab.errorfunc)&&ab.errorfunc.call(ad,L,h,i,null),ab.restoreAfterError===!0&&b(ad).jqGrid("restoreRow",L,ab.afterrestorefunc)}}},error:function(h,i,j){if(b("#lui_"+b.jgrid.jqID(ad.p.id)).hide(),b(ad).triggerHandler("jqGridInlineErrorSaveRow",[L,h,i,j,ab]),b.isFunction(ab.errorfunc)){ab.errorfunc.call(ad,L,h,i,j)}else{var k=h.responseText||h.statusText;try{b.jgrid.info_dialog(aq.errcap,'<div class="'+ap+'">'+k+"</div>",ar.bClose,{buttonalign:"right",styleUI:ad.p.styleUI})}catch(l){alert(k)}}ab.restoreAfterError===!0&&b(ad).jqGrid("restoreRow",L,ab.afterrestorefunc)}},b.jgrid.ajaxOptions,ad.p.ajaxRowOptions||{}))}}return ak}},restoreRow:function(a,f){var g=b.makeArray(arguments).slice(1),h={};return"object"===b.type(g[0])?h=g[0]:b.isFunction(f)&&(h.afterrestorefunc=f),h=b.extend(!0,{},b.jgrid.inlineEdit,h),this.each(function(){var e,k,l=this,m=-1,n={};if(l.grid&&(e=b(l).jqGrid("getInd",a,!0),e!==!1)){var o=b.isFunction(h.beforeCancelRow)?h.beforeCancelRow.call(l,h,a):void 0;if(void 0===o&&(o=!0),o){for(k=0;k<l.p.savedRow.length;k++){if(String(l.p.savedRow[k].id)===String(a)){m=k;break}}if(m>=0){if(b.isFunction(b.fn.datepicker)){try{b("input.hasDatepicker","#"+b.jgrid.jqID(e.id)).datepicker("hide")}catch(p){}}b.each(l.p.colModel,function(){this.editable===!0&&l.p.savedRow[m].hasOwnProperty(this.name)&&(n[this.name]=l.p.savedRow[m][this.name])}),b(l).jqGrid("setRowData",a,n),b(e).attr("editable","0").unbind("keydown"),l.p.savedRow.splice(m,1),b("#"+b.jgrid.jqID(a),"#"+b.jgrid.jqID(l.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){b(l).jqGrid("delRowData",a),b(l).jqGrid("showAddEditButtons")},0)}b(l).triggerHandler("jqGridInlineAfterRestoreRow",[a]),b.isFunction(h.afterrestorefunc)&&h.afterrestorefunc.call(l,a)}}})},addRow:function(a){return a=b.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,addRowParams:{extraparam:{}}},a||{}),this.each(function(){if(this.grid){var g=this,h=b.isFunction(a.beforeAddRow)?a.beforeAddRow.call(g,a.addRowParams):void 0;if(void 0===h&&(h=!0),h){if(a.rowID=b.isFunction(a.rowID)?a.rowID.call(g,a):null!=a.rowID?a.rowID:b.jgrid.randId(),a.useDefValues===!0&&b(g.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var c=this.editoptions.defaultValue,f=b.isFunction(c)?c.call(g):c;a.initdata[this.name]=f}}),b(g).jqGrid("addRowData",a.rowID,a.initdata,a.position),a.rowID=g.p.idPrefix+a.rowID,b("#"+b.jgrid.jqID(a.rowID),"#"+b.jgrid.jqID(g.p.id)).addClass("jqgrid-new-row"),a.useFormatter){b("#"+b.jgrid.jqID(a.rowID)+" .ui-inline-edit","#"+b.jgrid.jqID(g.p.id)).click()}else{var i=g.p.prmNames,j=i.oper;a.addRowParams.extraparam[j]=i.addoper,b(g).jqGrid("editRow",a.rowID,a.addRowParams),b(g).jqGrid("setSelection",a.rowID)}}}})},inlineNav:function(a,g){var h=this[0],i=b.jgrid.getRegional(h,"nav"),j=b.jgrid.styleUI[h.p.styleUI].inlinedit;return g=b.extend(!0,{edit:!0,editicon:j.icon_edit_nav,add:!0,addicon:j.icon_add_nav,save:!0,saveicon:j.icon_save_nav,cancel:!0,cancelicon:j.icon_cancel_nav,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},i,g||{}),this.each(function(){if(this.grid&&!this.p.inlineNav){var c=b.jgrid.jqID(h.p.id),d=b.trim(b(h).jqGrid("getStyleUI",h.p.styleUI+".common","disabled",!0));if(h.p.navGrid||b(h).jqGrid("navGrid",a,{refresh:!1,edit:!1,add:!1,del:!1,search:!1,view:!1}),b(h).data("inlineNav")||b(h).data("inlineNav",g),h.p.force_regional&&(g=b.extend(g,i)),h.p.inlineNav=!0,g.addParams.useFormatter===!0){var e,l=h.p.colModel;for(e=0;e<l.length;e++){if(l[e].formatter&&"actions"===l[e].formatter){if(l[e].formatoptions){var m={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},n=b.extend(m,l[e].formatoptions);g.addParams.addRowParams={keys:n.keys,oneditfunc:n.onEdit,successfunc:n.onSuccess,url:n.url,extraparam:n.extraparam,aftersavefunc:n.afterSave,errorfunc:n.onError,afterrestorefunc:n.afterRestore}}break}}}g.add&&b(h).jqGrid("navButtonAdd",a,{caption:g.addtext,title:g.addtitle,buttonicon:g.addicon,id:h.p.id+"_iladd",internal:!0,onClickButton:function(){b(h).jqGrid("addRow",g.addParams),g.addParams.useFormatter||(b("#"+c+"_ilsave").removeClass(d),b("#"+c+"_ilcancel").removeClass(d),b("#"+c+"_iladd").addClass(d),b("#"+c+"_iledit").addClass(d))}}),g.edit&&b(h).jqGrid("navButtonAdd",a,{caption:g.edittext,title:g.edittitle,buttonicon:g.editicon,id:h.p.id+"_iledit",internal:!0,onClickButton:function(){var f=b(h).jqGrid("getGridParam","selrow");f?(b(h).jqGrid("editRow",f,g.editParams),b("#"+c+"_ilsave").removeClass(d),b("#"+c+"_ilcancel").removeClass(d),b("#"+c+"_iladd").addClass(d),b("#"+c+"_iledit").addClass(d)):(b.jgrid.viewModal("#alertmod_"+c,{gbox:"#gbox_"+c,jqm:!0}),b("#jqg_alrt").focus())}}),g.save&&(b(h).jqGrid("navButtonAdd",a,{caption:g.savetext||"",title:g.savetitle||"Save row",buttonicon:g.saveicon,id:h.p.id+"_ilsave",internal:!0,onClickButton:function(){var f=h.p.savedRow[0].id;if(f){var k=h.p.prmNames,o=k.oper,p=g.editParams;b("#"+b.jgrid.jqID(f),"#"+c).hasClass("jqgrid-new-row")?(g.addParams.addRowParams.extraparam[o]=k.addoper,p=g.addParams.addRowParams):(g.editParams.extraparam||(g.editParams.extraparam={}),g.editParams.extraparam[o]=k.editoper),b(h).jqGrid("saveRow",f,p)&&b(h).jqGrid("showAddEditButtons")}else{b.jgrid.viewModal("#alertmod_"+c,{gbox:"#gbox_"+c,jqm:!0}),b("#jqg_alrt").focus()}}}),b("#"+c+"_ilsave").addClass(d)),g.cancel&&(b(h).jqGrid("navButtonAdd",a,{caption:g.canceltext||"",title:g.canceltitle||"Cancel row editing",buttonicon:g.cancelicon,id:h.p.id+"_ilcancel",internal:!0,onClickButton:function(){var f=h.p.savedRow[0].id,k=g.editParams;f?(b("#"+b.jgrid.jqID(f),"#"+c).hasClass("jqgrid-new-row")&&(k=g.addParams.addRowParams),b(h).jqGrid("restoreRow",f,k),b(h).jqGrid("showAddEditButtons")):(b.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+c,jqm:!0}),b("#jqg_alrt").focus())}}),b("#"+c+"_ilcancel").addClass(d)),g.restoreAfterSelect===!0&&b(h).bind("jqGridBeforeSelectRow.inlineNav",function(f,k){h.p.savedRow.length>0&&h.p.inlineNav===!0&&k!==h.p.selrow&&null!==h.p.selrow&&(h.p.selrow===g.addParams.rowID?b(h).jqGrid("delRowData",h.p.selrow):b(h).jqGrid("restoreRow",h.p.selrow,g.editParams),b(h).jqGrid("showAddEditButtons"))})}})},showAddEditButtons:function(){return this.each(function(){if(this.grid){var a=b.jgrid.jqID(this.p.id),d=b.trim(b(this).jqGrid("getStyleUI",this.p.styleUI+".common","disabled",!0));b("#"+a+"_ilsave").addClass(d),b("#"+a+"_ilcancel").addClass(d),b("#"+a+"_iladd").removeClass(d),b("#"+a+"_iledit").removeClass(d)}})}})});