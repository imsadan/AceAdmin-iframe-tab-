!function(b){"function"==typeof define&&define.amd?define(["jquery","./grid.base"],b):b(jQuery)}(function(b){b.jgrid.extend({setSubGrid:function(){return this.each(function(){var a,g,h=this,i=b.jgrid.styleUI[h.p.styleUI||"jQueryUI"].subgrid,j={plusicon:i.icon_plus,minusicon:i.icon_minus,openicon:i.icon_open,expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0};if(h.p.subGridOptions=b.extend(j,h.p.subGridOptions||{}),h.p.colNames.unshift(""),h.p.colModel.unshift({name:"subgrid",width:b.jgrid.cell_width?h.p.subGridWidth+h.p.cellLayout:h.p.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0}),a=h.p.subGridModel,a[0]){for(a[0].align=b.extend([],a[0].align||[]),g=0;g<a[0].name.length;g++){a[0].align[g]=a[0].align[g]||"left"}}})},addSubGridCell:function(a,h){var i,j,k,l="";return this.each(function(){l=this.formatCol(a,h),j=this.p.id,i=this.p.subGridOptions.plusicon,k=b.jgrid.styleUI[this.p.styleUI||"jQueryUI"].common}),'<td role="gridcell" aria-describedby="'+j+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+l+"><a style='cursor:pointer;' class='ui-sghref'><span class='"+k.icon_base+" "+i+"'></span></a></td>"},addSubGrid:function(a,d){return this.each(function(){var c=this;if(c.grid){var s,t,u,v,w,x=b.jgrid.styleUI[c.p.styleUI||"jQueryUI"].base,y=b.jgrid.styleUI[c.p.styleUI||"jQueryUI"].common,z=function(g,h,i){var j=b("<td align='"+c.p.subGridModel[0].align[i]+"'></td>").html(h);b(g).append(j)},A=function(j,k){var l,n,o,p=b("<table class='"+x.rowTable+" ui-common-table'><tbody></tbody></table>"),q=b("<tr></tr>");for(n=0;n<c.p.subGridModel[0].name.length;n++){l=b("<th class='"+x.headerBox+" ui-th-subgrid ui-th-column ui-th-"+c.p.direction+"'></th>"),b(l).html(c.p.subGridModel[0].name[n]),b(l).width(c.p.subGridModel[0].width[n]),b(q).append(l)}b(p).append(q),j&&(o=c.p.xmlReader.subgrid,b(o.root+" "+o.row,j).each(function(){if(q=b("<tr class='"+y.content+" ui-subtblcell'></tr>"),o.repeatitems===!0){b(o.cell,this).each(function(f){z(q,b(this).text()||"&#160;",f)})}else{var e=c.p.subGridModel[0].mapping||c.p.subGridModel[0].name;if(e){for(n=0;n<e.length;n++){z(q,b(e[n],this).text()||"&#160;",n)}}}b(p).append(q)}));var r=b("table:first",c.grid.bDiv).attr("id")+"_";return b("#"+b.jgrid.jqID(r+k)).append(p),c.grid.hDiv.loading=!1,b("#load_"+b.jgrid.jqID(c.p.id)).hide(),!1},B=function(j,k){var l,r,G,H,I,J,K=b("<table class='"+x.rowTable+" ui-common-table'><tbody></tbody></table>"),L=b("<tr></tr>");for(G=0;G<c.p.subGridModel[0].name.length;G++){l=b("<th class='"+x.headerBox+" ui-th-subgrid ui-th-column ui-th-"+c.p.direction+"'></th>"),b(l).html(c.p.subGridModel[0].name[G]),b(l).width(c.p.subGridModel[0].width[G]),b(L).append(l)}if(b(K).append(L),j&&(I=c.p.jsonReader.subgrid,r=b.jgrid.getAccessor(j,I.root),void 0!==r)){for(G=0;G<r.length;G++){if(H=r[G],L=b("<tr class='"+y.content+" ui-subtblcell'></tr>"),I.repeatitems===!0){for(I.cell&&(H=H[I.cell]),J=0;J<H.length;J++){z(L,H[J]||"&#160;",J)}}else{var M=c.p.subGridModel[0].mapping||c.p.subGridModel[0].name;if(M.length){for(J=0;J<M.length;J++){z(L,H[M[J]]||"&#160;",J)}}}b(K).append(L)}}var N=b("table:first",c.grid.bDiv).attr("id")+"_";return b("#"+b.jgrid.jqID(N+k)).append(K),c.grid.hDiv.loading=!1,b("#load_"+b.jgrid.jqID(c.p.id)).hide(),!1},C=function(h){var i,j,k,l;if(i=b(h).attr("id"),j={nd_:(new Date).getTime()},j[c.p.prmNames.subgridid]=i,!c.p.subGridModel[0]){return !1}if(c.p.subGridModel[0].params){for(l=0;l<c.p.subGridModel[0].params.length;l++){for(k=0;k<c.p.colModel.length;k++){c.p.colModel[k].name===c.p.subGridModel[0].params[l]&&(j[c.p.colModel[k].name]=b("td:eq("+k+")",h).text().replace(/\&#160\;/gi,""))}}}if(!c.grid.hDiv.loading){switch(c.grid.hDiv.loading=!0,b("#load_"+b.jgrid.jqID(c.p.id)).show(),c.p.subgridtype||(c.p.subgridtype=c.p.datatype),b.isFunction(c.p.subgridtype)?c.p.subgridtype.call(c,j):c.p.subgridtype=c.p.subgridtype.toLowerCase(),c.p.subgridtype){case"xml":case"json":b.ajax(b.extend({type:c.p.mtype,url:b.isFunction(c.p.subGridUrl)?c.p.subGridUrl.call(c,j):c.p.subGridUrl,dataType:c.p.subgridtype,data:b.isFunction(c.p.serializeSubGridData)?c.p.serializeSubGridData.call(c,j):j,complete:function(e){"xml"===c.p.subgridtype?A(e.responseXML,i):B(b.jgrid.parse(e.responseText),i),e=null}},b.jgrid.ajaxOptions,c.p.ajaxSubgridOptions||{}))}}return !1},D=0;b.each(c.p.colModel,function(){(this.hidden===!0||"rn"===this.name||"cb"===this.name)&&D++});var E=c.rows.length,F=1;for(void 0!==d&&d>0&&(F=d,E=d+1);E>F;){b(c.rows[F]).hasClass("jqgrow")&&(c.p.scroll&&b(c.rows[F].cells[a]).unbind("click"),b(c.rows[F].cells[a]).bind("click",function(){var e=b(this).parent("tr")[0];if(t=c.p.id,s=e.id,w=b("#"+t+"_"+s+"_expandedContent"),b(this).hasClass("sgcollapsed")){if(v=b(c).triggerHandler("jqGridSubGridBeforeExpand",[t+"_"+s,s]),v=v===!1||"stop"===v?!1:!0,v&&b.isFunction(c.p.subGridBeforeExpand)&&(v=c.p.subGridBeforeExpand.call(c,t+"_"+s,s)),v===!1){return !1}c.p.subGridOptions.reloadOnExpand===!0||c.p.subGridOptions.reloadOnExpand===!1&&!w.hasClass("ui-subgrid")?(u=a>=1?"<td colspan='"+a+"'>&#160;</td>":"",b(e).after("<tr role='row' id='"+t+"_"+s+"_expandedContent' class='ui-subgrid ui-sg-expanded'>"+u+"<td class='"+y.content+" subgrid-cell'><span class='"+y.icon_base+" "+c.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(c.p.colNames.length-1-D,10)+"' class='"+y.content+" subgrid-data'><div id="+t+"_"+s+" class='tablediv'></div></td></tr>"),b(c).triggerHandler("jqGridSubGridRowExpanded",[t+"_"+s,s]),b.isFunction(c.p.subGridRowExpanded)?c.p.subGridRowExpanded.call(c,t+"_"+s,s):C(e)):w.show().removeClass("ui-sg-collapsed").addClass("ui-sg-expanded"),b(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+y.icon_base+" "+c.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded"),c.p.subGridOptions.selectOnExpand&&b(c).jqGrid("setSelection",s)}else{if(b(this).hasClass("sgexpanded")){if(v=b(c).triggerHandler("jqGridSubGridRowColapsed",[t+"_"+s,s]),v=v===!1||"stop"===v?!1:!0,v&&b.isFunction(c.p.subGridRowColapsed)&&(v=c.p.subGridRowColapsed.call(c,t+"_"+s,s)),v===!1){return !1}c.p.subGridOptions.reloadOnExpand===!0?w.remove(".ui-subgrid"):w.hasClass("ui-subgrid")&&w.hide().addClass("ui-sg-collapsed").removeClass("ui-sg-expanded"),b(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+y.icon_base+" "+c.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed"),c.p.subGridOptions.selectOnCollapse&&b(c).jqGrid("setSelection",s)}}return !1})),F++}c.p.subGridOptions.expandOnLoad===!0&&b(c.rows).filter(".jqgrow").each(function(e,f){b(f.cells[0]).click()}),c.subGridXml=function(e,f){A(e,f)},c.subGridJson=function(e,f){B(e,f)}}})},expandSubGridRow:function(a){return this.each(function(){var f=this;if((f.grid||a)&&f.p.subGrid===!0){var g=b(this).jqGrid("getInd",a,!0);if(g){var h=b("td.sgcollapsed",g)[0];h&&b(h).trigger("click")}}})},collapseSubGridRow:function(a){return this.each(function(){var f=this;if((f.grid||a)&&f.p.subGrid===!0){var g=b(this).jqGrid("getInd",a,!0);if(g){var h=b("td.sgexpanded",g)[0];h&&b(h).trigger("click")}}})},toggleSubGridRow:function(a){return this.each(function(){var f=this;if((f.grid||a)&&f.p.subGrid===!0){var g=b(this).jqGrid("getInd",a,!0);if(g){var h=b("td.sgcollapsed",g)[0];h?b(h).trigger("click"):(h=b("td.sgexpanded",g)[0],h&&b(h).trigger("click"))}}})}})});